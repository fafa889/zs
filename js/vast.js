/*!
   ZsCz JW Player version 8.12.5
*/
!function(){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function s(e){return function(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var o,l="vast",d="-1",u="time",c="[ERRORCODE]",h="__jwpseg__",p="beforeComplete",f="vmap",v=5e3,m=15e3,g="jwp",y="jwpspotx",k="autostartNotAllowed",A="viewable",w=5,P="playing",b="adBidRequest",_="adBidResponse",T="adBreakEnd",I="adBreakIgnored",E="adBreakStart",C="adError",S="adImpression",R="adItem",x="adLoaded",j="adPlayComplete",M="adPodError",L="adRequest",O="adSchedule",V="external",B=V,H="click",D="play",q="error",N="complete",F=[S,C,M],U=["adStarted","adComplete",S,"adClick","adSkipped",C,"adPlay","adPause","adMeta"],X="instream",Q="article",W=(n(o={},[X],1),n(o,["banner"],2),n(o,[Q],3),n(o,["feed"],4),n(o,["floating"],5),n(o,["interstitial"],5),n(o,["slider"],5),o),z="inference",$=function(){function e(i,r,n,s,o){var l=this;t(this,e),this.player=i,this.state=i.state,this.vpaidURL=n,this.adTag=s,this.adParams=o.adParams,this.vpaidControls=o.vpaidControls,this.remainingTimeInterval=null,this.type="vpaid",this.instream=r||i.createInstream(),this.vpaidState={linear:!1,expanded:!1,remainingTime:-1},this.paused=!1,a(this,i.Events),this.setMuteCallback=function(){l.handleMute?l.setMute():l.handleMute=!0},this.playerContainer=this.player.getContainer(),o.adOptOut?setTimeout((function(){l.sendEvent("error",{message:"Conditional ad rejected",code:408})}),0):this.iframe=function(e,t,i,r){var n=document.createElement("iframe");n.setAttribute("allow","autoplay"),n.src="javascript:false",n.classList.add("jw-vpaid-iframe"),n.scrolling="no",i.querySelector(".jw-media").appendChild(n);var a=n.contentWindow.document;return a.open().write("\n    <body onload=\"\n        var js = document.createElement('script');\n        js.src = '".concat(t,"';\n        js.addEventListener('load', function() { window.myCallback(); });\n        document.body.appendChild(js);\"\n    style=\"margin: 0\">")),n.contentWindow.myCallback=r,a.close(),n}(i.utils,this.vpaidURL,this.playerContainer,this.callback.bind(this))}return r(e,[{key:"sendEvent",value:function(e,t){(t=t||{}).tag||(t.tag=this.adTag),this.trigger(e,t)}},{key:"sendTimeEvent",value:function(e,t,i){var r=t.getAdDuration(),n=t.getAdRemainingTime(),s=a({duration:r},i);this.sendEvent(e,s),n>0&&(s.position=r-n,this.trigger("time",s))}},{key:"handleQuartile",value:function(e,t){this.sendTimeEvent("quartile",e,{quartile:t})}},{key:"genEvent",value:function(e){var t=this;return function(i){t.on(e,i)}}},{key:"setMute",value:function(){var e=0===this.vpaidAd.getAdVolume();this.player.getMute()!==e&&this.player.setMute(e)}},{key:"prepareNonlinearAd",value:function(){if(this.player.utils.style(this.iframe,{height:150}),this.iframe.classList.add("jw-vpaid-non-linear"),this.resize(null,150),this.instream){this.instream.noResume=!0,this.instream.applyProviderListeners(null),this.instream.destroy(),this.instream=null;var e=this.playerContainer.querySelector(".jw-media"),t=e.querySelector("video,audio");e.insertBefore(t,this.iframe),t.play()}}},{key:"progressInterval",value:function(e){var t=this;if(clearInterval(this.remainingTimeInterval),e&&e.getAdRemainingTime){var i=-1;this.remainingTimeInterval=setInterval((function(){if(!t.paused){var r=e.getAdRemainingTime();isNaN(r)||r<=0||i===r||(i=r,t.sendTimeEvent("remainingTimeChange",e,{remainingTime:r}))}}),250)}}},{key:"genListeners",value:function(e){var t=this;return{AdLoaded:function(){e.setAdVolume(t.getPlayerVolume()),e.startAd()},AdStarted:function(){var i=e.getAdDuration?e.getAdDuration():0,r=!e.getAdLinear||e.getAdLinear(),n=r?"linear":"nonlinear";r?(t.vpaidControls||(t.instream=t.instream||t.player.createInstream(),t.instream.hide()),t.progressInterval(e)):t.prepareNonlinearAd(),t.sendEvent("impression",{linear:n,duration:i}),t.sendEvent("play",{oldstate:"buffering",newstate:P,linear:n}),t.handleMute=!0,e.subscribe(t.setMuteCallback,"AdVolumeChange",e)},AdVideoStart:function(){t.sendEvent("started")},AdStopped:function(){t.sendEvent("stopped")},AdPaused:function(){t.paused||(t.paused=!0,t.sendEvent("pause",{newstate:"paused",oldstate:P}))},AdPlaying:function(){if(t.paused){var i=!e.getAdLinear||e.getAdLinear()?"linear":"nonlinear";t.paused=!1,t.sendEvent("play",{newstate:P,oldstate:"paused",linear:i})}},AdLinearChange:function(){!e.getAdLinear||e.getAdLinear()?(t.player.utils.style(t.iframe,{height:"100%"}),t.player.off(null,null,t),t.instream=t.instream||t.player.createInstream(),t.instream.init(),t.vpaidControls||t.instream.hide()):t.prepareNonlinearAd()},AdDurationChange:function(){t.sendTimeEvent("remainingTimeChange",e,{isDurationChange:!0,remainingTime:e.getAdRemainingTime()})},AdRemainingTimeChange:function(){t.paused||t.sendTimeEvent("remainingTimeChange",e,{remainingTime:e.getAdRemainingTime()})},AdExpandedChange:function(){t.sendEvent("expandedChange",{expanded:e.getAdExpanded()})},AdSkippableStateChange:function(){t.sendEvent("skippableStateChange",{skippable:e.getAdSkippableState()})},AdSkipped:function(){t.sendEvent("skipped")},AdVideoFirstQuartile:function(){t.handleQuartile(e,1)},AdVideoMidpoint:function(){t.handleQuartile(e,2)},AdVideoThirdQuartile:function(){t.handleQuartile(e,3)},AdVideoComplete:function(){t.sendEvent("complete")},AdUserClose:function(){t.sendEvent("close")},AdClickThru:function(e,i,r){t.sendEvent("click",{id:i,url:e,playerHandles:r})},AdError:function(e){var i=function(e){if(e){var t=e.match(/\b(?:[34])[0-9]{2}\b/);if(t)return parseInt(t[0],10);if(e.match(/timeout/i))return e.match(/vpaid|vast/i)?301:402;if(e.match(/found/i))return 401;if(e.match(/supported/i))return 403;if(e.match(/(?:displaying|media file)/i))return 405}return 901}(e);t.sendEvent("error",{message:e,code:i,adErrorCode:5e4+i})}}}},{key:"callback",value:function(){try{this.vpaidAd=this.iframe.contentWindow.getVPAIDAd();var e=this.vpaidAd.handshakeVersion("2.0");if(parseFloat(e)<1)throw new Error("Invalid vpaid version in handshake")}catch(e){return void this.sendEvent("error",{message:e.message||"VPAID general error",code:901,adErrorCode:51901})}var t=this.vpaidAd,i=this.genListeners(t);Object.keys(i).forEach((function(e){t.subscribe(i[e],e,t)})),this.listeners=i;var r={AdParameters:this.adParams},n=this.iframe.contentWindow.document.createElement("div");n.className="jw-vpaid-wrapper",n.style.height="100%",this.iframe.contentWindow.document.body.appendChild(n),this.vpaidURL.indexOf("//imasdk.googleapis.com/js/sdkloader/vpaid_adapter.js")>=0&&(this.iframe.contentWindow.HTMLVideoElement=HTMLVideoElement);var a={videoSlot:this.instream.getMediaElement(),slot:n};t.initAd(this.player.getWidth(),this.player.getHeight(),"normal",1e3,r,a),t.setAdVolume(this.getPlayerVolume())}},{key:"play",value:function(){this.vpaidAd.resumeAd()}},{key:"pause",value:function(){this.vpaidAd.pauseAd()}},{key:"skip",value:function(){return!(!this.vpaidAd.skipAd||!this.vpaidAd.getAdSkippableState())&&(this.vpaidAd.skipAd(),!0)}},{key:"stop",value:function(){if(this.vpaidAd)try{this.vpaidAd.stopAd()}catch(e){}}},{key:"getPlayerVolume",value:function(){return this.player.getMute()?0:this.player.getVolume()/100}},{key:"setVolume",value:function(e){this.handleMute=!1,this.vpaidAd.setAdVolume(e/100)}},{key:"resize",value:function(e,t){if(this.vpaidAd&&this.vpaidAd.resizeAd){var i=this.player.getFullscreen()||document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen?"fullscreen":"normal";this.vpaidAd.resizeAd(e||this.player.getWidth(),t||this.player.getHeight(),i)}}},{key:"destroy",value:function(){if(this.removeEvents(),clearInterval(this.remainingTimeInterval),this.vpaidAd)try{var e=this.listeners,t=this.vpaidAd;Object.keys(e).forEach((function(i){t.unsubscribe(e[i],i,t)})),t.unsubscribe(this.setMuteCallback,"AdVolumeChange",t)}catch(e){}this.iframe&&this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe),this.vpaidAd=null,this.player=null,this.instream=null}},{key:"removeEvents",value:function(){this.player&&this.player.off(null,null,this),this.off()}},{key:"attachMedia",value:function(){}},{key:"detachMedia",value:function(){}},{key:"volume",value:function(){}},{key:"mute",value:function(){}},{key:"getState",value:function(){return this.vpaidState.linear?this.paused?"paused":P:"idle"}}]),e}();var G=function(e){var t=Z("".concat(e,"Locator"));return null!==t&&function(i,r,a,s){var o=ne();window.addEventListener("message",(function t(i){var r=i?i.data:{};if("string"==typeof r)try{r=JSON.parse(r)}catch(e){r={}}var n="".concat(e,"Return");r[n]&&r[n].callId===o&&(removeEventListener("message",t),a(r[n].returnValue,r[n].success))}),!1);var l=void 0!==s?"version":"parameter",d=n({},["".concat(e,"Call")],n({command:i,callId:o,parameter:s},[l],r));t.postMessage(JSON.stringify(d),"*")}},J=/^(https?:\/\/).*.(?:ampproject.org|bing-amp.com)\/(?:.\/)*(.*)\/amp.*$/;var K=new RegExp(/^[^/]*:\/\/\/?([^\/]*)/);function Y(e){var t=e.match(K);return t&&t.length>1?t[1]:""}var Z=function(e){for(var t=window;t;){try{if(t.frames[e])break}catch(e){}t=t===window.top?null:t.parent}return t},ee=new RegExp(/^[^:\/?#]+:?\/\/[^\/?#]+/);var te=null,ie={gdprApplies:!0,consentData:""},re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return null===te&&(te=new Promise((function(e){var t=window.__tcfapi||G("__tcfapi");if(t)return t("getTCData",2,(function(t,i){e(!1!==i?{gdprApplies:t.gdprApplies,consentData:t.tcString}:null)}),null);var i=window.__cmp||G("__cmp");return i?i("getConsentData",null,(function(t,i){e(!1!==i?{gdprApplies:t.gdprApplies||t.isUserInEu,consentData:t.consentData}:null)})):e({gdprApplies:!1,consentData:""})})).then((function(e){return e&&(ie=e),ie}))),Promise.race([te,new Promise((function(t){setTimeout(t,e,ie)}))])},ne=Date.now||function(){return(new Date).getTime()};function ae(){var e,t,i=null!==document.referrer.match(ee)?(e=document.referrer,(t=e.match(J))&&t.length>1?"".concat(t[1]).concat(t[2]):e):"";if(window.top!==window.self){try{return{url:window.top.location.href,domain:window.top.document.domain,referrer:i}}catch(e){}return{url:i,domain:Y(i),referrer:""}}return{url:document.location.href,domain:document.domain,referrer:i}}function se(e){var t=e.advertising;if(t&&t.placement){var i=t.placement.toLowerCase();if(W[i])return W[i]}return W[t&&t.outstream?Q:X]}var oe=function(e){return e.replace(/^\s+|\s+$/g,"")};function le(e,t){var i,r=e.getPlugin(z),n=t.jwpseg_client_side,a=t.jwpseg||[];if(!n||!n.length||!r)return a;try{i=r.predict(n,t)}catch(e){return t.jwpseg||[]}var o=Object.keys(i).filter((function(e){return i[e]})),l=a.filter((function(e){return-1===n.indexOf(e)}));return[].concat(s(o),s(l))}var de=[];var ue=function(){function e(i,r,n,a,s){var o=this;t(this,e);var l=r||{};this.ad=i,this.map=l,this.debugTrackFn=n,this.trackerPlayerUtils=function(e){return{getPosition:function(){return e.getPosition()},getFile:function(){return e.getPlaylistItem().file},getPlacement:function(){return se(e.getConfig())},getUserAgent:function(){return navigator.userAgent}}}(a),this.trackingFilter=s,this.lastQuartile=0,this.progressEvents=[],this.breakStarted=!1,this.started=!1,this.firedError=!1,this.hasComp=!1,Object.keys(l).forEach((function(e){if(l.hasOwnProperty(e)&&0===e.indexOf("progress")){var t="".concat(e.split("_")[1]),i={key:e,offset:t,tracked:!1,percentage:!1};/^\d+%$/.test(t)?(i.percentage=!0,i.offset=parseFloat(t)):i.offset=a.utils.seconds(t),o.progressEvents.push(i)}})),this.setFactories()}return r(e,[{key:"getUrls",value:function(e){return this.map.hasOwnProperty(e)?this.map[e]:[]}},{key:"addUrl",value:function(e,t){this.map.hasOwnProperty(e)?this.map[e].push(t):(this.map[e]=[],this.map[e].push(t))}},{key:"trackPings",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.getUrls(e),r=this.trackingFilter,n=[],a=[],s=[];if(i.length){t=this.replaceMacros(t),i.forEach((function(e){if(e){if(Object.keys(t).forEach((function(i){e=e.replace(i,t[i])})),r&&!1===r(e))return void a.push(e);var i=new Image;i.src=e,n.push(e),s.push(i)}})),Array.prototype.push.apply(de,s);for(var o=de.length;o--&&(de[o].width||de[o].complete);)de.length=o}"function"==typeof this.debugTrackFn&&this.debugTrackFn({type:"ping",data:{pingType:e,urls:n,filteredUrls:a,images:s}})}},{key:"replaceMacros",value:function(e){var t,i,r,n,a,s,o,l=ie,d=l.gdprApplies,u=l.consentData;return e["[ADSERVINGID]"]=encodeURIComponent(this.ad.adServingId||""),e["[ASSETURI]"]=encodeURIComponent(this.trackerPlayerUtils.getFile()),e["[CACHEBUSTING]"]=Math.random().toString().slice(2,10),e["[CONTENTPLAYHEAD]"]=encodeURIComponent((t=this.trackerPlayerUtils.getPosition(),i=("0"+Math.floor(t/3600)).slice(-2),r=("0"+Math.floor((t-3600*i)/60)).slice(-2),i+":"+r+":"+("0"+Math.floor(t-3600*i-60*r)).slice(-2)+"."+(t%1).toFixed(3).toString().slice(2,5))),e["[DEVICEUA]"]=encodeURIComponent(this.trackerPlayerUtils.getUserAgent()),e["[GDPRCONSENT]"]=u,e["[PAGEURL]"]=encodeURIComponent(ae().url),e["[PLACEMENTTYPE]"]=this.trackerPlayerUtils.getPlacement(),e["[REGULATIONS]"]=d?"gdpr":"",e["[TIMESTAMP]"]=encodeURIComponent((n=new Date,a=n.getTime(),s=n.getTimezoneOffset()/60,o=6e4*n.getTimezoneOffset(),new Date(a-o).toISOString().slice(0,-1)+(s>0?"-":"+")+("0"+s).slice(-2))),e}},{key:"start",value:function(){this.started=!0,this.trackPings("start")}},{key:"breakStart",value:function(){this.breakStarted=!0,this.trackPings("breakStart")}},{key:"time",value:function(e,t){if(!(t<=1)){for(var i=(4*e+.05)/t|0;i>this.lastQuartile&&this.lastQuartile<3;)this.lastQuartile++,1===this.lastQuartile?this.trackPings("firstQuartile"):2===this.lastQuartile?this.trackPings("midpoint"):3===this.lastQuartile&&this.trackPings("thirdQuartile");this.trackProgress(e,t)}}},{key:"trackProgress",value:function(e,t){for(var i=this.progressEvents.length;i--;){var r=this.progressEvents[i];if(!r.tracked){var n=r.offset;r.percentage&&(n=t*n/100),e>=n&&(r.tracked=!0,this.trackPings(r.key))}}}},{key:"error",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:900;this.firedError=!0;var t={};t[c]=e,this.trackPings("error",t)}},{key:"factory",value:function(e){var t=this;return function(){t.trackPings(e)}}},{key:"setFactories",value:function(){this.creativeView=this.factory("creativeView"),this.click=this.factory("click"),this.skip=this.factory("skip"),this.complete=this.factory("complete"),this.pause=this.factory("pause"),this.resume=this.factory("resume"),this.mute=this.factory("mute"),this.unmute=this.factory("unmute"),this.fullscreen=this.factory("fullscreen"),this.expand=this.factory("expand"),this.collapse=this.factory("collapse"),this.acceptInvitation=this.factory("acceptInvitation"),this.close=this.factory("close"),this.rewind=this.factory("rewind"),this.impression=this.factory("impression"),this.breakEnd=this.factory("breakEnd")}}]),e}();function ce(e,t,i,r){var n=he(e,i,r),s=t.adErrorCode||60900;return a(n,{message:t.message,code:t.code>=100&&t.code<=1008?t.code:900,adErrorCode:s}),10402===s||50004===s||50400===s?n.timeout=i?i.creativeTimeout:r.creativeTimeout:11007!==s&&10301!==s&&60006!==s||(n.timeout=i?i.requestTimeout:r.requestTimeout),void 0!==t.id&&(n.id=t.id),void 0!==t.sourceError&&(n.sourceError=t.sourceError),void 0!==t.tag&&(n.tag=t.tag),void 0!==t.vmap&&(n.vmap=t.vmap),n}function he(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r={client:l};if(null===e)return r;e.isDestroyed()||(r.placement=se(e.player.getConfig()));var n=i.schedule;if(n)return a(r,{item:e.item,tag:n.getVMAP(),adbreaks:n.getAllAds().map((function(t){var i={type:t._type,offset:t._offSet};t._vmap?i.vmap=t._vmap:i.adbreak=a({},t._adbreak);var r=e.bidsResult[t.adBreakId];return r&&a(i,r.getEventObject()),i}))});if(e.config.preloadAds&&(r.preloadAds=i.preload||t&&t._preload||!1),i.jwpseg&&(r.jwpseg=i.jwpseg),t){var s=e.getAdIds(t,i),o=s.adBreakId;a(r,{adBreakId:o,adPlayId:s.adPlayId,offset:t._offSet});var d=e.bidsResult[o];d&&a(r,d.getEventObject())}var u=t&&(i.tag||t._currentTag);return u&&(a(r,{id:t._id,tag:u,adposition:t._position,sequence:t._adPodIndex+1,witem:t._waterfallIndex+1,wcount:t._adQueue?t._adQueue.length:1,adsystem:t.adsystem||""}),t.adServingId&&(r.adServingId=t.adServingId),void 0!==t.skipoffset&&(r.skipoffset=t.skipoffset),t.wrappedTags&&a(r,{wrapperAdSystem:t.wrapper||"",wrappedTags:t.wrappedTags.slice(1)}),t._adbreak&&(r.adschedule=t._adbreak,r.adschedule.offset=t._offSet)),t&&t.companions&&i.companions?(r.companions=i.companions,r):(t&&t.response?(a(r,{adtitle:t.adTitle||"",description:t.description||"",adId:t.adId||"",advertiser:t.advertiser||"",advertiserId:t.advertiserId||"",creativeId:t.creativeId||"",creativeAdId:t.creativeAdId||"",request:t.request,response:t.response,conditionalAd:t.conditionalAd,conditionalAdOptOut:e.params.conditionaladoptout,vastversion:t.vastversion,clickThroughUrl:t.clickthrough,duration:i.duration,linear:i.linear}),"boolean"==typeof t.mediaFileCompliance&&(r.mediaFileCompliance=t.mediaFileCompliance,t.nonComplianceReasons&&(r.nonComplianceReasons=t.nonComplianceReasons)),t.selectedMedia&&(r.mediafile={file:t.selectedMedia.file}),i.metadata&&(r.adMessage=e.params.dynamicMessage||"",t.companions&&(r.companions=t.companions),t.sequence&&(r.podMessage=e.params.podMessage||""),void 0!==t.skipoffset&&a(r,{skipMessage:e.params.skipMessage,skipText:e.params.skipText}))):r.item=e.item,r)}function pe(e){return e.isBeforePlay()||0===e.getPosition()&&"idle"===e.getState()?"pre":e.isBeforeComplete()||e.getPosition()===e.getDuration()?"post":"mid"}var fe=function(){function e(i,r,n){t(this,e),this.player=i,this.icon=r,this.div=n;var a=this.utils=i.utils;this.images=[],this.iconContainer=function(e,t){var i=document.createElement("div");return i.className="jw-ad-icon-container",t.style(i,e),i}(r.style,a);var s=function(e,t){var i,r=e.resourceSource,n=e.resourceType;switch(n){case"iframe":(i=document.createElement("iframe")).src=r,i.scrolling="no";break;case"html":i=document.createElement("div"),t.replaceInnerHtml(i,r);break;default:(i=document.createElement("img")).src=r,i.setAttribute("type",n)}return t.addClass(i,"jw-ad-icon"),i}(r.resource,a);this.iconContainer.appendChild(s),n.appendChild(this.iconContainer);var o=1e3*a.seconds(r.offset);o>0?this.showTimeout=setTimeout(this.show.bind(this),o):this.show(),this.ui=new a.UI(this.iconContainer).on("click tap",this.clickHandler,this)}return r(e,[{key:"clickHandler",value:function(){this.player.pause({reason:"clickthrough"}),this.sendPing(this.icon.trackers.iconClick),this.utils.openLink(this.icon.clickThrough,"_blank",{rel:"noreferrer"})}},{key:"show",value:function(){clearTimeout(this.showTimeout),this.utils.addClass(this.iconContainer,"jw-ad-icon-active"),this.sendPing(this.icon.trackers.iconView),this.icon.duration&&(this.duration=this.utils.seconds(this.icon.duration),this.beginningPosition=this.utils.seconds(this.icon.offset))}},{key:"updateTime",value:function(e){e-this.beginningPosition>=this.duration&&this.remove()}},{key:"sendPing",value:function(e){if(e){var t=this.images,i=new Image;i.src=e;for(var r=t.length;r--&&(t[r].width||t[r].complete);)t.length=r;t.push(i)}}},{key:"remove",value:function(){clearTimeout(this.showTimeout),this.div.contains(this.iconContainer)&&this.div.removeChild(this.iconContainer),this.ui&&(this.ui.destroy(),this.ui=null)}}]),e}();var ve=function(){function e(i,r,n,s,o,l,d){t(this,e),this.player=r,this.staticPlayer=n,this.companion=s,this.playlistItemManager=o,this.div=l,this.optionalParams=d,this.debugTrackFn=d.debugTrackFn,this.scheduledAd=i.scheduledAd(),this.vastBuffet=i.adBuffet(),this.vastAdPod=i.adPod(),this.vastAd=this.vastBuffet.length?this.vastBuffet[0]:null,this.adType=null,this.vpaidPlayer=null,this.instreamPlayer=null,this.blockingInstreamPlayer=null,this.mediaType=null,this.adPodItems=null,this.creativeTimeout=null,this.vastOptions=null,this.duration=0,this.position=0,this.initialIndex=0,this.viewablePlayedTime=0,this.adViewableImpressionHandler=r.utils.noop,this.lastPosition=null,this.reason=null,a(this,r.Events)}return r(e,[{key:"init",value:function(e,t){return this.init=function(){throw new Error("Adplayer can only be initialized once")},this.blockingInstreamPlayer=e,this.reason=t,this.prepareAdPod()?(this.player.on("fullscreen",this.playerFullscreenHandler,this),this.player.on("volume",this.playerVolumeHandler,this),this.player.on("mute",this.muteHandler,this),this.player.on("resize",this.playerResizeHandler,this),this.playAd()):Promise.reject()}},{key:"prepareAdPod",value:function(){var e,t=this,i=null,r=0,n=[];if(this.vastAd&&(ye(this.vastAd,this.debugTrackFn,this.player,this.optionalParams.trackingFilter),(i=this.prepareAdPodItem(this.vastAd))&&"vpaid"===i.adType&&!ge(this.vastAd)&&(i=null)),this.vastAdPod)for(var a=null,s=0;s<this.vastAdPod.length;s++){var o=this.vastAdPod[s];ye(o,this.debugTrackFn,this.player,this.optionalParams.trackingFilter);var l=this.prepareAdPodItem(o);if(l){if(a!==l.adType&&"instream"===a)break;if(a=l.adType,"vpaid"!==l.adType||ge(o)){var d=n.length+r===s;l&&d&&n.push(l)}else r++}else r++}return n.length||i?(n.length?(e=n,this.vastOptions=[],e.forEach((function(e){t.vastOptions.push(t.getInstreamOptions(e.vastAd))}))):(e=i,this.vastOptions=this.getInstreamOptions(this.vastAd)),this.adPodItems=e,!0):(this.scheduledAd._pod&&this.scheduledAd._pod.length||this.adError("No Compatible Creatives",403),!1)}},{key:"prepareAdPodItem",value:function(e){e.tracker.linear="linear";var t="".concat(e.media[0].adType).toLowerCase()||"instream";"vpaid"!==t||ge(e)||(t="instream");var i={vastAd:e,sources:[],adType:t};void 0!==this.scheduledAd.skipoffset&&(i.skipoffset=this.scheduledAd.skipoffset);var r=e.media,n={};if(r.forEach((function(e,t){i.sources.push({file:e.file,mimeType:e.type,type:(""+e.type).replace(/^(?:video|audio)\/(?:x-)?/,""),id:t}),n[e.file]={width:e.width||0,height:e.height||0,bitrate:e.bitrate||e.maxBitrate,id:t}})),"instream"===t&&(i.sources=function(e){var t;t=jwplayer.api.availableProviders.filter((function(e){return"flash"!==e.name}));var i=e.filter((function(e){return t.some((function(t){return t.supports(e)}))})),r=i.filter((function(e){return"3gpp"!==e.type}));return r.length?r:i}(i.sources)),0===i.sources.length)return null;var a=this.player.getSafeRegion(!1).width,s=this.player.getConfig().bandwidthEstimate||5e5,o=function(){var e=s/1e3*.95,t=i.sources.map((function(e){return n[e.file]})),r=t.filter((function(e){return e.width>=a})).sort((function(e,t){return e.width-t.width}));r.length||(r=t.sort((function(e,t){return t.width-e.width})));var o=r.filter((function(e){return e.width===r[0].width}));if(o.length>1){var l=o.reduce((function(t,i){return i.bitrate<e&&i.bitrate>t.bitrate?i:t})),d=o.reduce((function(t,i){return i.bitrate>=e&&i.bitrate<t.bitrate?i:t}));return l||d}return o[0]}().id;return i.vastAd.selectedMedia=i.sources.filter((function(e){return e.id===o}))[0],this.mediaType=i.vastAd.selectedMedia.mimeType.toLowerCase(),i.sources=[i.vastAd.selectedMedia],i}},{key:"getInstreamOptions",value:function(e){return{skipoffset:this.getSkipOffset(e),skipMessage:this.optionalParams.skipMessage,skipText:this.optionalParams.skipText}}},{key:"getSkipOffset",value:function(e){var t=[this.scheduledAd.skipoffset,this.optionalParams.skipoffset,e.skipoffset].filter((function(e){return null!=e}));return e.skipoffset=t.length?this.player.utils.seconds(t[0]):void 0,e.skipoffset}},{key:"getVastAd",value:function(){var e,t=this.scheduledAd._adPodIndex;if(this.adPodItems){if((e=this.adPodItems.length?this.adPodItems[t]:this.adPodItems).vastAd)return e.vastAd}else if(this.vastAdPod&&this.vastAdPod.length)return this.vastAdPod[t];return this.vastAd}},{key:"adError",value:function(e,t,i){clearTimeout(this.creativeTimeout),this.creativeTimeout=null;var r=this.getVastAd();ke(r),t=t||900;var n="vpaid"===this.adType?5e4:1e4;i=i||n+t;var s=a({},this.scheduledAd,r),o={jwpseg:s.jwpseg},l=ce(this.playlistItemManager,{message:e,code:t,adErrorCode:i},s,o);this.vastAdPod&&this.scheduledAd._adPodIndex<this.vastAdPod.length-1?this.triggerEvent(M,l):(r.tracker.error(l.code),this.triggerEvent(C,l),this.removePlayerListeners())}},{key:"playAd",value:function(){var e=this.scheduledAd._adPodIndex,t=this.adPodItems[e]||this.adPodItems;if(this.adType=t.adType,this.blockingInstreamPlayer){var i=this.optionalParams.loadingAd;this.blockingInstreamPlayer.setText(i)}if("vpaid"===this.adType)return this.playVpaid(t.vastAd);if("static"===this.adType)return this.playStatic(),Promise.resolve();var r=Array.isArray(this.adPodItems)?this.adPodItems.slice(e):this.adPodItems,n=Array.isArray(this.vastOptions)?this.vastOptions.slice(e):this.vastOptions;return this.initialIndex=e,this.playInstream(r,n)}},{key:"clearVpaidBlocking",value:function(){var e=this.vpaidPlayer.instream;e&&e!==this.blockingInstreamPlayer&&(this.vpaidPlayer.instream=null,this.clearBlocking(e))}},{key:"clearBlocking",value:function(e){(e=e||this.blockingInstreamPlayer)&&e!==this.instreamPlayer&&e.destroy()}},{key:"getState",value:function(){return this.instreamPlayer?this.instreamPlayer.getState():this.vpaidPlayer?this.vpaidPlayer.getState():""}},{key:"clearNonlinear",value:function(){this.staticPlayer.stop(),this.vpaidPlayer&&(this.clearVpaidBlocking(),this.vpaidPlayer&&(this.vpaidPlayer.stop(),this.vpaidPlayer.destroy(),this.vpaidPlayer=null))}},{key:"destroy",value:function(){if(this.off(),this.removePlayerListeners(),clearTimeout(this.creativeTimeout),this.creativeTimeout=null,this.instreamPlayer){var e=this.instreamPlayer;this.instreamPlayer=null,this.clearBlocking(e)}this.vpaidPlayer&&(this.clearVpaidBlocking(),this.vpaidPlayer&&(this.vpaidPlayer.destroy(),this.vpaidPlayer=null)),this.clearNonlinear(),ke(this.vastAd),this.player=null,this.instreamPlayer=null,this.scheduledAd=null,this.vastBuffet=null,this.vastAd=null,this.vastAdPod=null}},{key:"pause",value:function(e){var t=e.reason;this.reason=t||V,this.instreamPlayer?this.instreamPlayer.pause():this.vpaidPlayer&&this.vpaidPlayer.pause()}},{key:"play",value:function(e){var t=e.reason;this.reason=t||V,this.instreamPlayer?this.instreamPlayer.play():this.vpaidPlayer&&this.vpaidPlayer.play()}},{key:"skip",value:function(){if(this.instreamPlayer){var e=this.getSkipOffset(this.getVastAd());if(e>0&&this.position<e)return;this.instreamPlayer.skipAd()}else this.vpaidPlayer&&this.vpaidPlayer.skip()}},{key:"removePlayerListeners",value:function(){this.player&&(this.player.off("fullscreen",this.playerFullscreenHandler,this),this.player.off("volume",this.playerVolumeHandler,this),this.player.off("mute",this.muteHandler,this),this.player.off("viewable",this.viewableHandler,this)),this.instreamPlayer&&this.instreamPlayer.off(null,null,this),this.vpaidPlayer&&(this.vpaidPlayer.removeEvents(),this.clearVpaidBlocking(),this.vpaidPlayer&&(this.vpaidPlayer.destroy(),this.vpaidPlayer=null)),this.staticPlayer.stop(),this.staticPlayer.removeEvents()}},{key:"adEventObject",value:function(e){var t=this.getVastAd(),i=a({},this.scheduledAd,t),r=he(this.playlistItemManager,i);return r.viewable=this.player.getViewable(),this.adPodItems&&this.adPodItems.length&&(r.sequence=this.scheduledAd._adPodIndex+1,r.podcount=this.adPodItems.length),this.mediaType&&(r.creativetype=this.mediaType),this.scheduledAd._vmap&&(r.vmap=this.scheduledAd._vmap),-1!==U.indexOf(e)&&(r.universalAdId=t.universalAdId,r.categories=t.categories),r}},{key:"playStatic",value:function(){this.vastAd.tracker.linear="nonlinear";var e=this.vastAd.media[0];this.vastAd.selectedMedia=e;var t=this.vastAd.clickthrough||"",i=this.staticPlayer;i.removeEvents(),i.on("play",this.impressionHandler,this),i.on("play",this.playHandler,this),i.on("complete",this.combinedCompleteHandler,this),i.on("click",this.clickStaticHandler,this),i.on("error",this.staticErrorHandler,this),this.playlistItemManager.addStaticOffset(this.scheduledAd._offSet),i.playAd(e.file,t,e.minDuration,this.scheduledAd._currentTag,this.scheduledAd.requestTimeout),this.clearBlocking()}},{key:"creativeAdError",value:function(e,t,i){this.adError(e,t,i),this.adPodItems&&this.adPodItems.length-1>this.scheduledAd._adPodIndex&&(this.vpaidPlayer&&(this.vpaidPlayer.destroy(),this.vpaidPlayer=null),this.scheduledAd._adPodIndex++,this.playAd())}},{key:"playVpaid",value:function(e){var t=this;clearTimeout(this.creativeTimeout),this.creativeTimeout=setTimeout((function(){t.creativeAdError("VPAID tag communication timeout",900,50004)}),this.scheduledAd.creativeTimeout),this.vastAd=e;var i=ge(e),r=this.optionalParams.conditionaladoptout&&e.conditionalAd;if(this.vastAd.selectedMedia=i,this.mediaType=i.type,"flash"===me(i))return this.creativeAdError("Flash creatives are not supported",403,10403),Promise.reject();var n={adParams:this.vastAd.adParams,vpaidControls:this.optionalParams.vpaidcontrols,adOptOut:r};return this.vpaidPlayer=new $(this.player,this.blockingInstreamPlayer,i.file,this.scheduledAd._currentTag,n),this.blockingInstreamPlayer&&this.blockingInstreamPlayer.applyProviderListeners(this.vpaidPlayer),this.vpaidPlayer.on("play",this.playHandler,this),this.vpaidPlayer.on("pause",this.pauseHandler,this),this.vpaidPlayer.on("quartile",this.quartileHandler,this),this.vpaidPlayer.on("remainingTimeChange",this.remainingTimeHandler,this),this.vpaidPlayer.on("click",this.clickVpaidHandler,this),this.vpaidPlayer.on("error",this.playbackErrorHandler,this),this.vpaidPlayer.on("impression",this.impressionHandler,this),this.vpaidPlayer.on("expandedChange",this.vpaidExpandedHandler,this),this.vpaidPlayer.on("close",this.adCloseHandler,this),this.vpaidPlayer.on("skipped",this.vpaidAdSkipped,this),this.vpaidPlayer.on("stopped",this.endOfVpaidAdHandler,this),this.vpaidPlayer.on("complete",this.adCompleteHandler,this),this.vpaidPlayer.on("started",this.adStartedHandler,this),this.vpaidPlayer.on("skippableStateChange",this.skippableStateChangeHandler,this),Promise.resolve()}},{key:"skippableStateChangeHandler",value:function(e){e.skippable&&this.blockingInstreamPlayer&&(this.blockingInstreamPlayer.off("adSkipped",this.skipVpaidAd,this),this.blockingInstreamPlayer.setupSkipButton(0,this.optionalParams,this.player.utils.noop),this.blockingInstreamPlayer.on("adSkipped",this.skipVpaidAd,this))}},{key:"playInstream",value:function(e,t){var i=this,r=this.player.getEnvironment().OS;if(r.android&&2===r.version.major&&3===r.version.minor)return this.adError("Android 2.3 not supported",900,60007),Promise.reject();clearTimeout(this.creativeTimeout),this.creativeTimeout=setTimeout((function(){i.creativeAdError("Video creative timeout",402,10402)}),this.scheduledAd.creativeTimeout),this.blockingInstreamPlayer?this.instreamPlayer=this.blockingInstreamPlayer:this.instreamPlayer=this.player.createInstream().init(),this.instreamPlayer.on("play",this.playHandler,this),this.instreamPlayer.on("pause",this.pauseHandler,this),this.instreamPlayer.on("time",this.timeHandler,this),this.instreamPlayer.on("playlistItem",this.playlistItemHandler,this),this.instreamPlayer.on("complete",this.adCompleteHandler,this),this.instreamPlayer.on("playlistComplete",this.endOfAdBreakHandler,this),this.instreamPlayer.on("mute",this.muteHandler,this),this.instreamPlayer.on("instreamClick",this.clickInstreamHandler,this),this.instreamPlayer.on("adSkipped",this.adSkipped,this),this.instreamPlayer.on("error",this.playbackErrorHandler,this),this.instreamPlayer.on("mediaError",this.playbackErrorHandler,this),this.instreamPlayer.on("destroyed",(function(){i.instreamPlayer=null}),this);var n=this.instreamPlayer.loadItem(e,t);return this.clearBlocking(),n}},{key:"playerFullscreenHandler",value:function(e){var t=this.getVastAd().tracker;e.fullscreen&&t.started&&t.fullscreen()}},{key:"playerResizeHandler",value:function(e){this.vpaidPlayer&&this.vpaidPlayer.resize(e.width,e.height)}},{key:"playerVolumeHandler",value:function(e){this.vpaidPlayer&&this.vpaidPlayer.setVolume(e.volume)}},{key:"playlistItemHandler",value:function(e){this.instreamPlayer&&(this.scheduledAd._adPodIndex=e.index+this.initialIndex,this.scheduledAd._adPodIndex>0&&this.triggerEvent(R))}},{key:"impressionHandler",value:function(e){var t=this.getVastAd(),i=t.tracker;i.impression();var r=a({},this.scheduledAd,t);this.triggerEvent(S,he(this.playlistItemManager,r,{duration:e.duration||t.duration||this.getDurationFromVideoTag(),linear:e.linear||i.linear})),this.setupViewableListener()}},{key:"getDurationFromVideoTag",value:function(){var e=this.blockingInstreamPlayer?this.blockingInstreamPlayer.getMediaElement():null;return e?e.duration:0}},{key:"setupViewableListener",value:function(){this.player.off("viewable",this.viewableHandler,this),this.player.on("viewable",this.viewableHandler,this),this.viewableHandler({viewable:this.player.getViewable()})}},{key:"viewableHandler",value:function(e){e.viewable?(this.viewablePlayedTime=0,this.lastPosition=null,this.adViewableImpressionHandler=this.adViewableHandler):this.adViewableImpressionHandler=this.player.utils.noop}},{key:"playHandler",value:function(e){var t=this;clearTimeout(this.creativeTimeout),this.creativeTimeout=null;var i,r=this.getVastAd(),n=r.tracker;if(n.started)"paused"===e.oldstate&&(n.resume(),this.dispatchPlay(e));else{this.vpaidPlayer&&(n.linear=e.linear),this.instreamPlayer&&this.impressionHandler({linear:n.linear});var s=a({},this.scheduledAd,r),o=he(this.playlistItemManager,s,{linear:n.linear,metadata:!0});if(this.triggerEvent("adMeta",o),r.companions){var l=he(this.playlistItemManager,s,{companions:(i=r.companions,i.map((function(e){var t,i="iframe"===e.type||"html"===e.type?e.type:"static";return e.trackers&&e.trackers.creativeView&&e.trackers.creativeView.length&&(t=e.trackers.creativeView),{width:e.width,height:e.height,type:i,resource:e.source,creativeview:t,click:e.clickthrough}})))});this.triggerEvent("adCompanions",l)}r.icons&&(r.iconInstances=r.icons.map((function(e){return new fe(t.player,e,t.div)})));var d,u=this.companion;d=this.player.utils.flashVersion()>9?r.companions:function(e){if(e)return e.filter((function(e){return e.type.indexOf("flash")<0}));return[]}(r.companions),this.optionalParams.companion&&d&&d.length&&(n.hasComp=u.addCompanion(this.optionalParams.companion,d)),n.start(),n.creativeView(),this.dispatchPlay(e)}}},{key:"dispatchPlay",value:function(e){"static"===this.adType||"vpaid"===this.adType&&"linear"!==e.linear||(null===this.reason&&"vpaid"===this.adType&&(this.reason=B),this.setState(e))}},{key:"pauseHandler",value:function(e){clearTimeout(this.creativeTimeout),this.creativeTimeout=null,this.getVastAd().tracker.pause(),null===this.reason&&"vpaid"===this.adType&&(this.reason=B),this.setState(e)}},{key:"setState",value:function(e){var t=e.newstate,i=e.oldstate,r=t===P,n=this.adEventObject(r?"adPlay":"adPause");(n.newstate=t,null!==this.reason)&&(n[r?"playReason":"pauseReason"]=this.reason,this.reason=null);this.vpaidPlayer?(n.oldstate=i,this.vpaidPlayer.trigger("state",n)):this.instreamPlayer.setEventData(n)}},{key:"remainingTimeHandler",value:function(e){var t=this;e.duration?this.duration=e.duration:this.duration=Math.max(1,this.duration,e.remainingTime);var i=e.remainingTime>=0?this.duration-e.remainingTime:0;this.position===i?this.creativeTimeout=this.creativeTimeout||setTimeout((function(){t.creativeAdError("Video stall",400)}),this.scheduledAd.creativeTimeout):this.creativeTimeout&&(clearTimeout(this.creativeTimeout),this.creativeTimeout=null),this.timeHandler({position:i,duration:this.duration,isDurationChange:e.isDurationChange})}},{key:"quartileHandler",value:function(e){if(e.duration)this.duration=e.duration;else{var t=4*e.remainingTime/(4-e.quartile);this.duration=Math.max(this.duration,1,t)}this.timeHandler({position:this.duration*e.quartile*.25,duration:this.duration})}},{key:"adViewableHandler",value:function(e){var t=e.position;null===this.lastPosition&&(this.lastPosition=t);var i=t-this.lastPosition;this.lastPosition=t,i=Math.min(Math.max(0,i),4),this.viewablePlayedTime+=i,this.viewablePlayedTime>=2&&(this.player.off("viewable",this.viewableHandler,this),this.adViewableImpressionHandler=this.player.utils.noop,this.triggerEvent("adViewableImpression",{}))}},{key:"timeHandler",value:function(e){var t=this.getVastAd(),i=e.position,r=e.duration;this.adViewableImpressionHandler(e);var n=r-i,a=t.tracker,s=this.optionalParams.dynamicMessage||"",o=this.optionalParams.podMessage||"";if(s&&n>0){if(s=s.replace(/(\b)xx(s?\b)/gi,"$1".concat(Math.ceil(n),"$2")),this.adPodItems&&this.adPodItems.length>1&&o){var l=this.scheduledAd._adPodIndex+1;s=(o=(o=o.replace(/__AD_POD_CURRENT__/g,"".concat(l))).replace(/__AD_POD_LENGTH__/g,"".concat(this.adPodItems.length)))+" "+s}this.instreamPlayer?this.instreamPlayer.setText(s):this.vpaidPlayer&&this.vpaidPlayer.instream&&this.vpaidPlayer.instream.setText(s)}if(!e.isDurationChange){a&&a.time(i,r),t.iconInstances&&t.iconInstances.forEach((function(e){e.updateTime(i)}));var d={};d.position=this.position=i,d.duration=r,this.triggerEvent("adTime",d)}}},{key:"combinedCompleteHandler",value:function(){this.adCompleteHandler(),this.endOfAdBreakHandler()}},{key:"adCompleteHandler",value:function(){clearTimeout(this.viewableTimeout);var e=this.getVastAd();ke(e);var t=e.tracker;t.firedError||(t.complete(),this.triggerEvent("adComplete"))}},{key:"adCloseHandler",value:function(){clearTimeout(this.viewableTimeout);var e=this.getVastAd().tracker;e.firedError||e.close()}},{key:"adStartedHandler",value:function(){this.triggerEvent("adStarted")}},{key:"endOfVpaidAdHandler",value:function(){if(clearTimeout(this.viewableTimeout),this.adPodItems&&this.adPodItems.length-1>this.scheduledAd._adPodIndex)return this.vpaidPlayer&&(this.vpaidPlayer.destroy(),this.vpaidPlayer=null),this.scheduledAd._adPodIndex++,void this.playAd();this.endOfAdBreakHandler()}},{key:"endOfAdBreakHandler",value:function(){this.removePlayerListeners(),this.trigger(j)}},{key:"muteHandler",value:function(e){var t=this.getVastAd().tracker;t&&(e.mute?t.mute():t.unmute(),this.vpaidPlayer&&this.vpaidPlayer.setVolume(e.mute?0:this.player.getVolume()))}},{key:"clickStaticHandler",value:function(){var e=this.getVastAd();this.player.pause({reason:"clickthrough"}),this.clickThrough(e)}},{key:"clickVpaidHandler",value:function(e){var t=this.getVastAd(),i=!0;e&&void 0!==e.url&&(!1===e.playerHandles&&(i=!1),t.clickthrough=e.url),this.clickThrough(t,i)}},{key:"clickInstreamHandler",value:function(){"paused"!==this.instreamPlayer.getState()&&this.clickThrough(this.getVastAd())}},{key:"clickThrough",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.tracker.click();var i={};e.clickthrough&&(i.clickThroughUrl=e.clickthrough),this.reason="clickthrough",this.triggerEvent("adClick",i),window.jwcast&&window.jwcast.player.id||e.clickthrough&&t&&window.open(e.clickthrough)}},{key:"skipVpaidAd",value:function(){this.vpaidPlayer&&this.vpaidPlayer.skip()&&this.vpaidAdSkipped()}},{key:"vpaidAdSkipped",value:function(){this.adSkipped(),this.endOfVpaidAdHandler()}},{key:"adSkipped",value:function(){clearTimeout(this.viewableTimeout);var e=this.getVastAd();e.tracker.skip(),ke(e);var t="vpaid"===this.adType?void 0:this.getSkipOffset(e);this.triggerEvent("adSkipped",{duration:e.duration,skipoffset:t,position:this.position,watchedPastSkipPoint:this.position-t})}},{key:"playbackErrorHandler",value:function(e){var t=e.message||"Error Playing Ad Tag",i=e.code;i&&232404===i?i=403:(!i||i<=4||i>901)&&(i=405),this.vpaidPlayer&&"function"==typeof this.vpaidPlayer.off?(this.vpaidPlayer.off(),this.creativeAdError(t,i,e.adErrorCode)):this.adError(t,i,e.adErrorCode)}},{key:"staticErrorHandler",value:function(){this.adError("Unable to fetch NonLinear resource",502)}},{key:"vpaidExpandedHandler",value:function(e){var t=this.getVastAd().tracker;e.expanded?t.expand():t.collapse()}},{key:"triggerEvent",value:function(e,t){var i=this.adEventObject(e);t&&a(i,t),this.trigger(e,i),-1===F.indexOf(e)&&this.player.trigger(e,i)}}]),e}();function me(e){return function(e){return"application/javascript"===e.type||"application/x-javascript"===e.type}(e)?"html5":"flash"}function ge(e){for(var t,i=0;i<e.media.length;i++){var r=e.media[i];if("html5"===me(r)){t=r;break}}return t}function ye(e,t,i,r){e.tracker=new ue(e,e.trackers,t,i,r)}function ke(e){e&&e.iconInstances&&(e.iconInstances.forEach((function(e){e.remove()})),e.iconInstances=null)}var Ae=function(){function e(i,r,n){t(this,e),this.debugTrackFn=i,this.div=null,this.elem=null,this.environment=r,this.utils=n}return r(e,[{key:"addCompanion",value:function(e,t){if(this.div=e,this.elem=document.getElementById(this.div.id),!this.elem)return!1;for(var i=0;i<t.length;i++)if(this.fitsDiv(t[i]))return this.placeCompanion(t[i]),!0;return!1}},{key:"removeCompanion",value:function(){this.elem.innerHTML=""}},{key:"sendPings",value:function(e){(e=e.creativeView)&&(e.forEach((function(e){(new Image).src=e})),"function"==typeof this.debugTrackFn&&this.debugTrackFn({type:"companion",data:{trackers:e}}))}},{key:"placeCompanion",value:function(e){var t=this;if(this.removeCompanion(),"html"===e.type){var i=document.createElement("div");i.innerHTML=e.source;var r=i.getElementsByTagName("script");return r.length&&r.forEach((function(e){new t.utils.scriptloader(e.src).load(),e.parentElement.removeChild(e)})),this.elem.appendChild(i),void this.sendPings(e.trackers)}if("iframe"===e.type){var n=document.createElement("iframe");return n.height=this.div.height,n.width=this.div.width,n.src=e.source,n.scrolling="no",n.style.border="none",n.marginWidth=0,n.marginHeight=0,this.sendPings(e.trackers),this.elem.innerHTML="",void this.elem.appendChild(n)}if("application/x-shockwave-flash"===e.type){var a=document.createElement("object");return a.setAttribute("type","application/x-shockwave-flash"),a.setAttribute("data",e.source),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.setAttribute("tabindex",0),we(a,"allowfullscreen","true"),we(a,"allowscriptaccess","always"),we(a,"seamlesstabbing","true"),we(a,"wmode","opaque"),this.elem.appendChild(a),void this.sendPings(e.trackers)}var s=new Image;s.src=e.source,e.clickthrough&&(s.onclick=function(){t.utils.openLink(e.clickthrough,"_blank",{rel:"noreferrer"})}),this.elem.innerHTML="",this.elem.appendChild(s),this.sendPings(e.trackers)}},{key:"fitsDiv",value:function(e){return e.width===this.div.width&&e.height===this.div.height}}]),e}();function we(e,t,i){var r=document.createElement("param");r.setAttribute("name",t),r.setAttribute("value",i),e.appendChild(r)}var Pe=/^((https?:)?\/\/)?(secure)?pubads\.g\.doubleclick\.net\/gampad\/ads\?[\S]*$/;function be(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(!e)return Promise.resolve(e);var a=function(e,t){var i=e.getConfig(),r=e.getPlaylistItem()===t;return{playerHeight:e.getHeight()||i.height||"",playerWidth:e.getWidth()||i.width||"",itemDuration:r?(n=e.getDuration(),a=3,s=Math.pow(10,a),Math.round(n*s)/s||""):"",item:t,jwpseg:le(e,t),placement:se(i),userAgent:navigator.userAgent};var n,a,s}(t,i),s=ae();-1!==e.indexOf(h)&&(n.jwpseg=a.jwpseg),e=_e(e,"__random-number__",Math.random()*Math.pow(10,18)),e=_e(e,"__timestamp__",(new Date).getTime()),e=_e(e,"__page-url__",encodeURIComponent(s.url)),e=_e(e,"__referrer__",encodeURIComponent(s.referrer)),e=_e(e,"__player-height__",a.playerHeight),e=_e(e,"__player-width__",a.playerWidth),e=_e(e,"__item-duration__",a.itemDuration),e=_e(e,h,a.jwpseg),e=_e(e,"__domain__",encodeURIComponent(s.domain)),e=_e(e,"__placement__",a.placement),e=_e(e,"__device-ua__",encodeURIComponent(a.userAgent));for(var o=null,l=/__item-([\w-]+?)(-list)?__/g,d=e=r.companion?_e(e,"__companion-div__",r.companion.id):_e(e,"__companion-div__","");null!==(o=l.exec(d));){var u=o[0],c=o[1],p="";if(i.hasOwnProperty(c)&&"string"==typeof i[c]){(p=i[c]).length>1e3&&(p=p.substring(0,1e3));var f=o[2]?",":null;p=p.split(f).map(encodeURIComponent)}e=_e(e,u,p)}var v=t.getConfig().autostart?1:0,m=t.getMute()?1:0;return-1!==(e=function(e,t,i){Pe.test(e)&&(e="".concat(e,"&vpa=").concat(t,"&vpmute=").concat(i));return e}(e,v,m)).indexOf("__gdpr__")||-1!==e.indexOf("__gdpr_consent__")?re().then((function(t){var i=t.gdprApplies,r=t.consentData;return e=_e(e,"__gdpr__",i?1:0),_e(e,"__gdpr_consent__",r)})).catch((function(){return e})):Promise.resolve(e)}function _e(e,t,i){return e.replace(t,i)}var Te=Array.prototype,Ie=Te.forEach,Ee=Te.map,Ce=function(){};function Se(e,t,i){e.push({message:t,code:1002,adErrorCode:11002,id:i})}function Re(){var e=new Error("No AdBreaks in VMAP");throw e.adErrorCode=60005,e}var xe=function(){function i(e,r){t(this,i),this.utils=r,this._error=null,this._version=null,e&&this.parse(e)}return r(i,[{key:"error",value:function(){return this._error}},{key:"version",value:function(){return this._version}},{key:"parse",value:function(e,t){var i,r=this;"VAST"===e.nodeName?i=e:(i=Me(e,"VAST"))||(i=Me(e,"VideoAdServingTemplate")),i||this.throwError(101,"Invalid VAST response");var n="VideoAdServingTemplate"===i.tagName?1:parseFloat(Oe(i,"version")||0);this._version=n;var a,s=je(i,"Ad"),o=Ee.call(s,(function(i){var a=r.parseAd(n,i);return a.vastversion=n,a.response=e,a.request=t||null,a}));return o.length||(a=je(i,"Error"),Ie.call(a,(function(e){var t=Be(e).replace(c,303);(new Image).src=t}))),o}},{key:"parseAd",value:function(t,i,r){r=r||{};var n,s,o,l=Me(i,"InLine"),d=Me(i,"Wrapper"),u=l||d,c=Me(u,"Advertiser");return r.sequence=Oe(i,"sequence"),r.adId=Oe(i,"id"),r.adTitle=Be(Me(u,"AdTitle")),r.advertiser=Be(c),r.advertiserId=Oe(c,"id"),r.description=Be(Me(u,"Description")),(!t||t>4.2||t<2)&&this.throwError(102,"Vast version not supported"),t>=4&&(r.conditionalAd=!!Oe(i,"conditionalAd")),u?(De(u,"Impression",(n=function(e,t,i){var r=je(Me(e,"Creatives"),"Creative"),n={},a={trackers:n};a.adServingId=Be(Me(e,"AdServingId")),a.adsystem=Be(Me(e,"AdSystem"));var s=je(e,"Category");return a.categories=Ee.call(s,(function(e){return Be(e)})),Ie.call(r,(function(e){var r=Me(e,"Linear"),s=Me(e,"NonLinear"),o=je(Me(e,"TrackingEvents"),"Tracking");if(t>=4){var l=je(e,"UniversalAdId");a.universalAdId=Ee.call(l,(function(e){return{universalAdIdRegistry:Oe(e,"idRegistry")||"unknown",universalAdIdValue:Be(e)||Oe(e,"idValue")||"unknown"}}))}a.creativeId=Oe(e,"id"),a.creativeAdId=Oe(e,"adId"),(r||s)&&Ie.call(o,(function(e){Ve(n,e)}));var d=Be(Me(e,"AdParameters"));if(d&&(a.adParams=d),r){var u=Me(r,"VideoClicks"),c=Be(Me(u,"ClickThrough")),h=je(u,"ClickTracking"),p=Oe(r,"skipoffset"),f=Be(Me(r,"Duration"));Ie.call(h,(function(e){He(n,"click",Be(e))})),f&&(a.duration=i.seconds(f)),c&&(a.clickthrough=c),void 0!==p&&(a.skipoffset=p),function(e,t){var i=je(Me(e,"MediaFiles"),"MediaFile"),r=t.media?t.media:[];t.media=r.concat(Ee.call(i,(function(e){return{type:Oe(e,"type"),file:Be(e),adType:Oe(e,"apiFramework")||"",width:parseInt(Oe(e,"width"),10)||0,height:parseInt(Oe(e,"height"),10)||0,bitrate:parseInt(Oe(e,"bitrate"),10)||null,maxBitrate:parseInt(Oe(e,"maxBitrate"),10)||null}})).filter((function(e){return e.file})))}(r,a),function(e,t){var i=je(e,"Icon");t.icons=Array.prototype.reduce.call(i,(function(e,t){var i,r;if(i=Me(t,"StaticResource"))r=Oe(i,"creativeType");else if(i=Me(t,"IFrameResource"))r="iframe";else{if(!(i=Me(t,"HTMLResource")))return e;r="html"}var n=Be(i),a={};a.iconClick=Be(Me(t,"IconClickTracking"))||null,a.iconView=Be(Me(t,"IconViewTracking"))||null;var s=Oe(t,"xPosition"),o=Oe(t,"yPosition"),l={};return"left"===s||"right"===s?l[s]=0:l.left=parseInt(s,10)||0,"top"===o||"bottom"===o?l[o]=0:l.top=parseInt(o,10)||0,l.width=parseInt(Oe(t,"height"),10)||0,l.height=parseInt(Oe(t,"height"),10)||0,e.push({program:Oe(t,"program"),style:l,apiFramework:Oe(t,"apiFramework"),offset:Oe(t,"offset")||"00:00:00",duration:Oe(t,"duration")||null,clickThrough:Be(Me(t,"IconClickThrough")),trackers:a,resource:{resourceType:r,resourceSource:n}}),e}),t.icons||[])}(r,a)}else if(s){var v=Be(Me(s,"NonLinearClickThrough"));v&&(a.clickthrough=v),function(e,t){var i=[],r=Me(e,"StaticResource");r&&(i.push({type:Oe(r,"creativeType"),file:Be(r),adType:Oe(Me(e,"NonLinear"),"apiFramework")||"static",minDuration:Oe(Me(e,"NonLinear"),"minSuggestedDuration")||"00:00:00"}),t.media=i)}(e,a)}else!function(e,t){var i=je(Me(e,"CompanionAds"),"Companion"),r=t.companions?t.companions:[];Ie.call(i,(function(e){var t,i,n=Me(e,"StaticResource"),a=Me(e,"IFrameResource"),s=Me(e,"HTMLResource"),o={};if(n)t=Oe(n,"creativeType"),i=Be(n);else if(a)t="iframe",i=Be(a);else{if(!s)return;t="html",i=Be(s)}var l=je(Me(e,"TrackingEvents"),"Tracking");Ie.call(l,(function(e){var t=Oe(e,"event");He(o,t,Be(e))}));var d=Be(Me(e,"CompanionClickThrough"));r.push({width:parseInt(Oe(e,"width"),10),height:parseInt(Oe(e,"height"),10),type:t,source:i,trackers:o,clickthrough:d})})),t.companions=r}(e,a)})),a}(u,t,this.utils)).trackers),De(u,"Error",n.trackers),function(e){var t={};e.media&&e.media.forEach((function(e){var i=e.type,r="application/x-mpegURL"===i||"vnd.apple.mpegURL"===i;"vpaid"===e.adType.toLowerCase()||r||(t[i]=t[i]||0,t[i]++)}));e.mediaFileCompliance=!0,Object.keys(t).forEach((function(i){var r=t[i];r<3&&(e.mediaFileCompliance=!1,e.nonComplianceReasons=e.nonComplianceReasons||[],e.nonComplianceReasons.push("".concat(i," has only ").concat(r," qualities")))}))}(n),d&&(n.wrappedURI=Be(Me(d,"VASTAdTagURI"))||Be(Me(d,"VASTAdTagURL")),n.followAdditionalWrappers=JSON.parse(Oe(d,"followAdditionalWrappers")),n.allowMultipleAds=JSON.parse(Oe(d,"allowMultipleAds")),n.fallbackOnNoAd=JSON.parse(Oe(d,"fallbackOnNoAd"))),s=n,o=a({},r),Object.keys(s).forEach((function(t){var i=s[t];Array.isArray(o[t])?o[t]=o[t].concat(i):"object"===e(o[t])&&null!==o[t]?o[t]=a(o[t],i):o[t]=i})),n=o):this.throwError(303,"No ads",10303),n}},{key:"throwError",value:function(e,t,i){throw this._error=new Error(t),this._error.code=e,this._error.adErrorCode=i||1e4+e,this._error}}]),i}();function je(e,t,i){var r=[];return e&&(r=e.getElementsByTagName(t),i&&r&&0===r.length&&(r=e.getElementsByTagName("".concat(i,":").concat(t)))),r}function Me(e,t){if(e){var i=e.getElementsByTagName(t);if(i)return i[0]}return null}function Le(e,t,i,r){var n=[];return e||t?n=t.getElementsByTagNameNS?t.getElementsByTagNameNS(e,i):t.getElementsByTagName("".concat(r,":").concat(i)):n}function Oe(e,t){return e?e.getAttribute(t):null}function Ve(e,t){var i=Oe(t,"event");if("progress"===i){var r=Oe(t,"offset");i="".concat(i,"_").concat(r)}He(e,i,Be(t))}function Be(e){if(e){var t=e.textContent||e.text;if(t)return oe(t)}return""}function He(e,t,i){e[t]||(e[t]=[]),i&&(e[t].push(i),qe(i))}function De(e,t,i){var r=je(e,t);Ee.call(r,(function(e){He(i,t.toLowerCase(),Be(e))}))}var qe=function(e){(e.indexOf("[REGULATIONS]")>=0||e.indexOf("[GDPRCONSENT]")>=0)&&(re().catch(Ce),qe=Ce)};function Ne(e){e.onload=e.onreadystatechange=e.onerror=null,"abort"in e&&e.abort()}var Fe=function(){function e(i,r){t(this,e),this.adRules=i,this.utils=r,this.preRoll=null,this.vmap=null,this.postRoll=null,this.midRolls=[],this.playedMidRolls=[],this.duration=0,this._vmapPromise=null,this._vmapXHR=null}return r(e,[{key:"load",value:function(e,t,i){var r=this;if(this._vmapPromise)return this._vmapPromise;null!==this._vmapXHR&&(Ne(this._vmapXHR),this._vmapXHR=null);var n=be(this.getVMAP(),e,t,i);return this._vmapPromise=n.then((function(t){return new Promise((function(i,n){r._vmapXHR=e.utils.ajax({url:t,withCredentials:!0,retryWithoutCredentials:!0,requireValidXML:!0,timeout:r.requestTimeout},i,(function(e,t,i,r){return n(r)}))})).then((function(i){return r._vmapXHR=null,function(e,t,i){var r=[],n=je(e,"VMAP",f);if(!n.length)throw new Error("No VMAP tag in response");Oe(n[0],"version")||Se(r,"VMAP Schema Error: version missing from VMAP tag",d);var a=je(e,"AdBreak",f);a.length||Re();for(var s=e.lookupNamespaceURI(f),o=0;o<a.length;o++){var l={},u={},c=a[o],h=Oe(c,"timeOffset"),p=Oe(c,"breakId"),v=Oe(c,"breakType"),m=Oe(je(c,"AdSource",f)[0],"id"),g=je(c,"AdTagURI",f)[0],y=je(c,"VASTData",f)[0]||je(c,"VASTAdData",f)[0],k=Oe(g,"templateType"),A=Be(g),w=Le(s,c,"Tracking",f);if(v||Se(r,"VMAP Schema Error: missing breakType on AdBreak",p),y||k||Se(r,"VMAP Schema Error: missing templateType on AdBreak",p),h||Se(r,"VMAP Schema Error: missing timeOffset on AdBreak",p),l._type=v,l._vmap={id:m,breakid:p,timeoffset:h},y)l._adXML=Me(y,"VAST");else{if("vast2"!==k&&"vast3"!==k&&"vast4"!==k)continue;l._adQueue=[A],l._waterfallIndex=0}var P=[];if(w)for(var b=0;b<w.length;b++){Ve(u,w[b]);var _=Oe(w[b],"event");P.push(_)}switch((P.indexOf("breakStart")<0||P.indexOf("breakEnd")<0||P.indexOf("error")<0)&&Se(r,"Tracking events are missing breakStart, breakEnd, or error for AdBreak",p),l._trackers=u,l._type=v,h){case"start":l._offSet="pre",t.setPreRoll(l);break;case"100%":case"end":l._offSet="post",t.setPostRoll(l);break;default:if(/^#/.test(h))break;/^\d\d?(?:\.\d+)?%$/.test(h)?l._offSet=h:l._offSet=i.seconds(h),t.addMidRoll(l)}}return t.preRoll||t.midRolls.length||t.postRoll||Re(),t.sort(null,!0),r}(i.responseXML,r,e.utils).map((function(e){return a(e,{vmap:t})}))})).catch((function(i){r._vmapXHR=null;var n={id:d,vmap:t};if(i.message)a(n,{message:"VMAP Schema Error: ".concat(i.message),code:1002,adErrorCode:i.adErrorCode||11002});else{var s={1:{code:1007,message:"Timeout"},602:{code:1e3,message:"Invalid XML"},default:{code:1008,message:e.getConfig().localization.errors[i.key]}},o=s[i.code]||s.default;e.utils.log(o.message),a(n,{message:"Error Loading VMAP Schedule",code:o.code,adErrorCode:o.code+1e4})}throw n}))})),this._vmapPromise}},{key:"canWaterfall",value:function(e){return e._adQueue&&e._waterfallIndex+1<e._adQueue.length}},{key:"getPreRoll",value:function(e){return e&&"none"===this.adRules.startOnSeek?null:Ue(this.preRoll,this.requestTimeout,this.creativeTimeout)}},{key:"getPostRoll",value:function(e){var t=Ue(this.postRoll,this.requestTimeout,this.creativeTimeout);return this.adRules.timeBetweenAdsAllowsAdPlayback(t,e)?t:null}},{key:"getMidRollAtIndex",value:function(e){return Ue(this.midRolls[e],this.requestTimeout,this.creativeTimeout)}},{key:"getLastMidRollIndexBetweenTime",value:function(e,t,i){if(e>t)return null;this.sort(i);for(var r=this.midRolls.length;r--;){var n=this.midRolls[r],a=Xe(this.midRolls[r]._offSet,i);if(e>=a)return null;if(t>=a){var s=Ue(n,this.requestTimeout,this.creativeTimeout);if(!this.adRules.timeBetweenAdsAllowsAdPlayback(s))return null;if(!this.adRules.timeBetweenAds){if(this.playedMidRolls.indexOf(r)>=0)return null;this.playedMidRolls.push(r)}return r}}return null}},{key:"peek",value:function(e,t,i){if(this.midRolls.length>this.playedMidRolls.length){this.sort(i);for(var r=0;this.midRolls[r];){var n=Xe(this.midRolls[r]._offSet,i);if(n>=e&&-1===this.playedMidRolls.indexOf(r)){var a=ne()+1e3*(n-e);return n<=t&&this.adRules.timeBetweenAdsAllowsAdPlayback(null,a)?r:null}r+=1}}var s=ne()+1e3*(i-e);return this.postRoll&&t>=i&&this.adRules.timeBetweenAdsAllowsAdPlayback(null,s)?-1:null}},{key:"getNextMidrollIndex",value:function(e,t,i){if(this.adRules.timeBetweenAds||this.adRules.startOnSeek)return this.getLastMidRollIndexBetweenTime(e,t,i);if(this.midRolls.length>this.playedMidRolls.length){var r=this.getClosestIndex(t,i);if(r>=0&&this.playedMidRolls.indexOf(r)<0)return this.playedMidRolls.push(r),r}return null}},{key:"getMidRolls",value:function(){var e=this;return this.midRolls.map((function(t){return Ue(t,e.requestTimeout,e.creativeTimeout)}))}},{key:"reset",value:function(){null!==this._vmapXHR&&(Ne(this._vmapXHR),this._vmapXHR=null),this.playedMidRolls=[],this.duration=0}},{key:"resetBreakIdByOffset",value:function(e){var t;e&&(t="pre"===e?this.preRoll:"post"===e?this.postRoll:this.midRolls[e],this.resetBreakId(t))}},{key:"setPreRoll",value:function(e){this.resetBreakId(e),this.preRoll=e}},{key:"addMidRoll",value:function(e){this.resetBreakId(e),this.midRolls.push(e),this.duration=0}},{key:"setPostRoll",value:function(e){this.resetBreakId(e),this.postRoll=e}},{key:"sort",value:function(e,t){(!e||e<1)&&(e=1),(this.duration!==e||t)&&(this.duration=e,this.midRolls.sort((function(t,i){return Xe(t._offSet,e)-Xe(i._offSet,e)})),function(e,t){for(var i=0;i<e.length;i++){var r=e[i];t?r._vmap.item=i+1:(r._adbreak={item:i+1,breakid:r._breakId},r._pod?r._adbreak.pod=r._pod:r._adbreak.tags=r._adQueue)}}(this.getAllAds(),t))}},{key:"getAllAds",value:function(){var e=this.preRoll?[this.preRoll]:[],t=this.postRoll?[this.postRoll]:[];return e.concat(this.midRolls,t)}},{key:"setVMAP",value:function(e){this.vmap=e}},{key:"isVMAP",value:function(){return!!this.vmap}},{key:"getVMAP",value:function(){return this.vmap}},{key:"getClosestIndex",value:function(e,t){this.sort(t);for(var i=this.midRolls.length;i--;)if(e>=Xe(this.midRolls[i]._offSet,t))return i;return-1}},{key:"resetBreakId",value:function(e){e.adBreakId=this.utils.genId(12)}}]),e}();function Ue(e,t,i){var r;if(null!==e)return Object.keys(e).forEach((function(t){var i=e[t];(r=r||{})[t]="_adQueue"===t||"_pod"===t?i.slice():i})),r?(r.requestTimeout=t,r.creativeTimeout=i,r._errors=[],r._waterfallIndex=0,r._adPodIndex=0,r):void 0}function Xe(e,t){return"%"===e.toString().slice(-1)?t*parseFloat(e.slice(0,-1))/100:parseFloat(e)}var Qe=function(){function e(i){t(this,e),this.utils=i}return r(e,[{key:"getSchedule",value:function(e,t){var i=new Fe(t,this.utils);if(i.requestTimeout=ze(e.requestTimeout,v),i.creativeTimeout=ze(e.creativeTimeout,m),e.tag)i.setPreRoll({_offSet:"pre",_adQueue:We(e.tag),_waterfallIndex:0});else if("string"==typeof e.vastxml)i.setPreRoll({_offSet:"pre",_adXML:e.vastxml});else{if("string"==typeof e.schedule)return i.setVMAP(e.schedule),i;if("string"==typeof e.adschedule)return i.setVMAP(e.adschedule),i;!function(e,t,i){var r=t.schedule||t.adschedule;if(!r)return;var n={};Object.keys(r).forEach((function(e){var t=r[e];t.ad&&(a(t,t.ad),delete t.ad);var s=function(e,t){if("start"===e||"0%"===e||!e&&0!==e)return"pre";if("end"===e||"100%"===e)return"post";if("pre"===e||"post"===e||(e+"").indexOf("%")>=0)return e;var i=t.seconds(e);if("number"==typeof i)return i;return!1}(t.offset,i),o=ze(t.requestTimeout,v),l=ze(t.creativeTimeout,m),d=n[s];if(d){if("nonlinear"===t.type)return;"nonlinear"===d._type&&(d=null)}var u=n[s]=d||{_offSet:s,_type:t.type,_breakId:e,requestTimeout:o,creativeTimeout:l};!1===s&&i.log("Error: ad offset format not supported",s);var c=t.skipoffset;if(void 0!==c&&void 0===u.skipoffset&&(u.skipoffset=c),t.pod){var h=u._pod||[];u._pod=h.concat(t.pod)}else if(t.tag){var p=function(e,t){if(!t)return e;var i=e.indexOf("?")>=0?"&":"?",r=e.indexOf("cust_params="),n="cust_params=".length,a="",s="";if(Object.keys(t).forEach((function(e){var i=t[e];a="".concat(a).concat(s).concat(e,"=").concat(i),s="&"})),a=encodeURIComponent(a),r>=0){var o=e.substr(0,r+n),l=e.substr(r+n);return"".concat(o).concat(a,"%26").concat(l)}return"".concat(e).concat(i,"cust_params=").concat(a)}(t.tag,t.custParams);u._adQueue&&(u._pod=[u._adQueue[0]],delete u._adQueue),u._pod?u._pod.push(We(p)[0]):u._adQueue=We(p)}else{if("string"!=typeof t.vastxml)return void i.log("Error: no ad tag provided");u._adXML=t.vastxml}})),Object.keys(n).forEach((function(i){var r=n[i];switch(r.skipoffset=void 0!==r.skipoffset?r.skipoffset:t.skipoffset,i){case"pre":e.setPreRoll(r);break;case"post":e.setPostRoll(r);break;default:e.addMidRoll(r)}}))}(i,e,this.utils)}return i.sort(),i}},{key:"getOptParams",value:function(e,t){var i={cuetext:t.cuetext,dynamicMessage:t.admessage,loadingAd:t.loadingAd,podMessage:t.podmessage,skipoffset:e.skipoffset,skipMessage:t.skipmessage,skipText:t.skiptext,vpaidcontrols:e.vpaidcontrols||!1,conditionaladoptout:e.conditionaladoptout||!1,requestFilter:e.requestFilter,trackingFilter:e.trackingFilter},r=e.companiondiv;return r&&(i.companion={id:r.id,height:r.height,width:r.width}),i}},{key:"getAdRules",value:function(e){var t=e.rules||{},i=parseInt(t.frequency,10);return{startOn:t.startOn||1,frequency:isNaN(i)?1:i,timeBetweenAds:t.timeBetweenAds||0,startOnSeek:t.startOnSeek||null,deferAds:t.deferAds||null}}}]),e}();function We(e){return Array.isArray(e)?e.slice(0):[e]}function ze(e,t){return 0===e?1/0:e||t}var $e,Ge,Je,Ke=function(){function i(e,r,n,s,o){t(this,i),this._scheduledAd=e,this.player=r,this.options=n||{},this.wrapperOptions=s||{followAdditionalAds:!0,allowMultipleAds:!0},this.debugTrackFn=o,a(this,r.Events),this._history=[],this.loadedAds=[],this.parser=null,this.promise=null,this.xmlhttp=null,this.wrappedTags=null,this.options.isPodItemLoader||(e.adPlayIds={})}return r(i,[{key:"load",value:function(e){var t=this;if(null===this.promise){this._history.push(e);var i=this.options.requestFilter;this.promise=new Promise((function(r,n){t.xmlhttp=t.player.utils.ajax({url:e,withCredentials:!0,retryWithoutCredentials:!0,requireValidXML:!0,timeout:t._scheduledAd.requestTimeout,requestFilter:i},r,(function(e,t,i,r){return n(r)}))})).catch((function(i){if(null!==t.player)throw t.ajaxError(i,e)})).then((function(i){if(null!==t.player)return t.parseXMLString(i.responseXML||i.responseText,e)}))}return this.promise}},{key:"destroy",value:function(){var e;(e=this.xmlhttp)&&(e.onload=null,e.onreadystatechange=null,e.onerror=null,e.abort&&e.abort()),this.player=null,this.xmlhttp=null}},{key:"scheduledAd",value:function(){return this._scheduledAd}},{key:"allAds",value:function(){return this.loadedAds}},{key:"podMultipleVastLoaders",value:function(e){var t=this,i=e.map((function(e){return e.then((function(e){var i=e.adPod();if(i.length)return i;var r=e.adBuffet();return r.length?[r[0]]:Promise.reject({vloader:t,message:"No compatible ad"})})).catch((function(e){return{error:e}}))}));return Promise.all(i).then((function(e){var i=0,r=e.reduce((function(e,r,n){if(r.error)return r.error.tagIndex=n,t.trigger(M,r.error),e;if(r.length&&0!==n){var a="p".concat(i,"w").concat(t._scheduledAd._waterfallIndex);t._scheduledAd.adPlayIds[a]=t._scheduledAd.adRequestIds[n]}return r.forEach((function(t){t.sequence=++i,e.push(t)})),e}),[]);return r.length?(t.loadedAds=r,t):null}))}},{key:"adPod",value:function(){var e=[];return this.loadedAds.forEach((function(t){t.sequence&&e.push(t)})),e.sort((function(e,t){return e.sequence-t.sequence})),e}},{key:"adBuffet",value:function(){var e=[];return this.loadedAds.forEach((function(t){t.sequence||e.push(t)})),e}},{key:"parseXMLString",value:function(t,r){var n=this;return null===this.parser&&(this.parser=new xe(null,this.player.utils)),new Promise((function(i){var r,a=(r=t,("object"===("undefined"==typeof Node?"undefined":e(Node))?r instanceof Node:r&&"object"===e(r)&&"number"==typeof r.nodeType&&"string"==typeof r.nodeName)?t:n.player.utils.parseXML(t));if(null===a){throw{message:"Invalid XML",code:100}}return i(n.parser.parse(a,n.xmlhttp))})).catch((function(e){if(null!==n.player){var t=e.code||900,i=e.adErrorCode||1e4+t;throw n.sendErrorEvent(e.message,t,i,r)}})).then((function(e){if(null===n.player)return null;if(0===e.length)throw n.sendErrorEvent("No ads",303,10303,r);var t=e.filter((function(e){return!e.sequence})).map((function(e){return e._currentTag=r,e}));n.wrapperOptions.allowMultipleAds?n.loadedAds=e:n.loadedAds=t,n.options.wrapper=n.options.wrapper||[],n.options.adsystem&&n.options.wrapper.push(n.options.adsystem),n.options.adsystem=n.loadedAds[0].adsystem;var a=[];return e.forEach((function(e,r){if(e.wrappedURI){if(!1===n.wrapperOptions.followAdditionalWrappers)return;n.options.wrappedTags=n.options.wrappedTags||[n._scheduledAd._currentTag],n.options.wrappedTags.push(e.wrappedURI);var s=new i(n._scheduledAd,n.player,n.options,{fallbackOnNoAd:e.fallbackOnNoAd,allowMultipleAds:e.allowMultipleAds,followAdditionalWrappers:e.followAdditionalWrappers},n.debugTrackFn).load(e.wrappedURI).then((function(t){var i,r,a,s=(i=e,r=t.allAds(),a=[],r.forEach((function(e){var t,r;i.companions&&(e.companions=(e.companions?e.companions:[]).concat(i.companions)),i.trackers&&(e.trackers=(t=e.trackers,r=i.trackers,t=t||{},Object.keys(r).forEach((function(e){var i=r[e];t[e]?t[e]=t[e].concat(i):t[e]=i})),t)),i.sequence&&(e.sequence=i.sequence),i._currentTag&&(e._currentTag=i._currentTag),a.push(e)})),a),o=n.loadedAds.indexOf(e);Array.prototype.splice.apply(n.loadedAds,[o,1].concat(s))})).catch((function(i){var a=n.sendAdpodErrorEvent(i,e,r),s=e.fallbackOnNoAd&&e.sequence&&t.length,o=n.loadedAds.indexOf(e);if(s)return e.loadError=a,void i.vloader.destroy();if(n.loadedAds.splice(o,1),i.vloader.destroy(),a.type!==M)throw a;n.trigger(M,a)}));a.push(s)}else n.options.wrapper.length&&(e.wrapper=n.options.wrapper,e.wrappedTags=n.options.wrappedTags)})),Promise.all(a)})).then((function(){if(null===n.player)return null;var e=n.loadedAds.filter((function(e){return!e.sequence}));n.loadedAds.forEach((function(t,i){if(t.loadError)if(e.length){var r=n.loadedAds[i+1],s=r&&!r.sequence?r:e[0];n.loadedAds[i]=a({},s,{sequence:t.sequence})}else n.trigger(M,t.loadError)}));var t=n.loadedAds.slice(0),i=t.length;t.forEach((function(e){e.media&&e.media.length||t.length--}));var r=0===i,s=t.length!==i;if(r||s)throw n.sendErrorEvent("Ad Tag Empty",101,10101,n._history[n._history.length-1]);return n}))}},{key:"ajaxError",value:function(e,t){if(this.player.getAdBlock())return this.sendErrorEvent("Ad playback blocked by an ad blocker",900,60003,t);var i=e.code;if(601===i||602===i)return this.sendErrorEvent("Invalid XML",100,10100,t);var r=this.options.wrappedTags&&this.options.wrappedTags.length,n=r?301:900,a=r?10301:60006;return this.sendErrorEvent(e.message||"Error loading file",n,a,t)}},{key:"firstUrl",value:function(){return this._history&&this._history.length?this._history[0]:""}},{key:"sendAdpodErrorEvent",value:function(e,t,i){var r=e.message,n=e.code,a=e.adErrorCode,s=e.url;if(1===this.loadedAds.length)return this.sendErrorEvent(r,n,a,s,i);var o={message:r,code:n,adErrorCode:a,podIndex:i,vloader:this,tag:this.firstUrl()||s,type:M};return this.trackError(o,t),this.wrappedTags=s,o}},{key:"sendErrorEvent",value:function(e,t,i,r,n){var a={message:e,code:t,adErrorCode:i,podIndex:n,vloader:this,tag:this.firstUrl()||r,adsystem:this.options.adsystem||""};return this.options.wrappedTags&&(a.wrapperAdSystem=this.options.wrapper||"",a.wrappedTags=this.options.wrappedTags),this.trackError(a),a}},{key:"trackError",value:function(e,t){var i=e.vloader.allAds();if(i&&i.length){var r=t||i[0];if(r){var n=r.trackers;if(n&&n.error)new ue(r,n,this.debugTrackFn,this.player,this.options.trackingFilter).error(e.code)}}}}]),i}();var Ye=2e3,Ze=3500,et="USD",tt=1,it="//c.amazon-adsystem.com/aax2/apstag.js",rt="video",nt="3.0.0",at="//js-sec.indexww.com/htv/htv-jwplayer.min.js",st="//js.spotx.tv/directsdk/v1/",ot="//search.spotxchange.com/ad/vast.html?key=",lt="dfp",dt="jwp",ut="jwpspotx",ct="jwpdfp",ht=dt,pt="APS",ft="Index",vt="OpenRTB",mt="SpotX",gt=(n($e={},[lt],[pt,"FAN",ft,vt,mt]),n($e,[dt],["FAN",vt,mt]),n($e,[ct],["FAN",vt,mt]),n($e,[ut],[mt]),$e),yt="Error loading script",kt=(n(Ge={},["EMX"],{endpoint:"https://hbint.emxdgt.com"}),n(Ge,["PubMatic"],{endpoint:"https://openbid.pubmatic.com/translator"}),n(Ge,["Telaria"],{endpoint:"https://jwplayer.eb.tremorhub.com/ad/rtb/jwp",preflight:!0}),n(Ge,["MediaGrid"],{endpoint:"https://grid.bidswitch.net/jw_bid"}),Ge),At=1,wt=2,Pt=1,bt=2,_t=3,Tt=4,It=5,Et=6,Ct=7,St=8,Rt=1,xt=2,jt=3,Mt=4,Lt=5,Ot=6,Vt={BID_WON:0,BID_BELOW_AUCTION_FLOOR:100,LOST_TO_HIGHER_BID:102},Bt="bid",Ht="error",Dt="invalid",qt="noBid",Nt=(n(Je={},[qt],0),n(Je,[Bt],1),n(Je,["timeout"],2),n(Je,[Dt],3),n(Je,["abort"],4),n(Je,[Ht],5),Je),Ft=550,Ut=590,Xt=599,Qt={0:500,400:501,500:503,597:502},Wt=[{message:"SpotX :: Unable to find ad",result:qt,code:Nt[qt]},{message:yt,result:Ht,code:6},{message:"Invalid options: 'slot' is required",code:300},{message:"Invalid options: 'slot' must be part of DOM",code:301},{message:"Invalid options: 'channel_id' is required.",code:302},{message:"Invalid options: 'content_width' and 'content_height' are required when no 'video_slot' is provided.",code:303},{message:"Invalid options: 'content_width' provided but 'content_height' is not.",code:304},{message:"Invalid options: 'content_height' provided but 'content_width' is not.",code:305},{message:"Invalid options: 'custom' must be an object.",code:306},{message:"Invalid options: 'token' must be an object.",code:307},{message:"Invalid options: 'ados' must be an object.",code:308},{message:"Invalid options: 'contentPageUrl' must be a string.",code:309},{message:"Invalid options: 'demand_source_timeout' must be a number.",code:310},{message:"Invalid options: 'total_bid_timeout' must be a number.",code:311}],zt=320,$t=[{message:"Incorrect domain",code:321},{message:"unsupported_platform",code:322},{message:"Request_URL_noncompliant",code:323},{message:"Application not authorised for header bidding",code:324},{message:"pageurl is required",code:325},{message:"adformats",code:326}],Gt=Date.now||function(){return(new Date).getTime()};function Jt(e,t){var i=(e||[]).filter((function(e){var i=e.min,r=e.max;return t>=(i||0)&&t<=(r||1/0)}))[0];if(i){var r=i.min?Math.floor(100*i.min):0,n=Math.floor(100*t),a=i.increment>=.01?Math.floor(100*i.increment):1;return(r+Math.floor((n-r)/a)*a)/100}return parseFloat(t)}function Kt(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=e.createElement(t);return n.appendChild(e.createCDATASection(i)),Object.keys(r).forEach((function(e){n.setAttribute(e,r[e])})),n}function Yt(e){if("start"===e||"0%"===e||!e||"pre"===e||"00:00:00"===e)return 0;if("end"===e||"100%"===e||"post"===e)return-2;if("string"==typeof e&&e.indexOf("%")>=0)return-1;var t=parseInt(e);return t>=0?t:-1}function Zt(e,t){return new t.scriptloader(e,!1,Ze).load().catch((function(){return Promise.reject({message:yt})}))}function ei(e){return e.outerHTML||(new XMLSerializer).serializeToString(e)}var ti=function(e){var t=e.autoplay,i=e.mute,r=e.autoplayAdsMuted;if(t){var n=i||r;return"viewable"===t?n?Ot:Lt:n?xt:Rt}return i?Mt:jt},ii=function(e,t){return e.replace(/\$\{AUCTION_ID\}/g,t.id).replace(/\$\{AUCTION_BID_ID\}/g,t.bid||"").replace(/\$\{AUCTION_IMP_ID\}/g,t.imp).replace(/\$\{AUCTION_SEAT_ID\}/g,t.seat||"").replace(/\$\{AUCTION_AD_ID\}/g,t.ad||"").replace(/\$\{AUCTION_CURRENCY\}/g,t.cur)},ri=function(e,t,i){var r=i?i.priceInCents:"",n=t.priceInCents?r/t.priceInCents:"",a=Vt[i?"LOST_TO_HIGHER_BID":"BID_BELOW_AUCTION_FLOOR"];return e.replace(/\$\{AUCTION_PRICE\}/g,r/100).replace(/\$\{AUCTION_MBR\}/g,n).replace(/\$\{AUCTION_LOSS\}/g,t.winner?Vt.BID_WON:a)},ni={postAuctionHandler:function(e,t){if((!t||t.winner)&&e.result===Bt){e.adm&&(e.adm=ri(e.adm,e,t));var i=e.winner?e.custom.nurl:e.custom.lurl;if(i)if(e.winner&&!e.adm)e.tag=ri(i,e,t);else{var r=new XMLHttpRequest;r.open("POST",ri(i,e,t));var n=kt[e.name];n&&n.preflight&&r.setRequestHeader("x-openrtb-version","2.5"),r.withCredentials=!0,r.send(null)}}return delete e.custom,e},requestBids:function(e,t,i,r){var a=kt[e.name];if(!a||!e.id||!e.pubid)return Promise.resolve({result:Dt});var s,o,l=r.getURLParts(),d={id:t.adPlayId,imp:[{id:"1",displaymanager:"jwplayer",tagid:e.id,video:{mimes:(s=["video/mp4","video/ogg","video/webm","video/aac","application/vnd.apple.mpegurl"],o=document.createElement("video"),s.filter((function(e){return o.canPlayType(e)}))).concat("application/javascript"),minduration:3,maxduration:300,protocols:[Pt,bt,_t,Ct,Tt,It,Et,St],w:t.playerWidth,h:t.playerHeight,startdelay:Yt(t.offset),placement:t.placement,linearity:1,playbackmethod:[ti(t)],api:[At,wt]},bidfloorcur:t.floorPriceCurrency,secure:"https:"===window.location.protocol?1:0}],site:{domain:l.domain,page:l.url,ref:l.referrer,publisher:{id:e.pubid}},device:{ua:window.navigator.userAgent,language:t.language.substring(0,2)},at:1};if(void 0!==t.skipoffset){var u=d.imp[0].video;t.skipoffset>=0?(u.skip=1,u.skipmin=t.skipoffset+2,u.skipafter=t.skipoffset):u.skip=0}if(void 0!==t.floorPriceCents&&(d.imp[0].bidfloor=t.floorPriceCents/100),(!0===t.autoplay||"viewable"===t.autoplay&&t.viewable)&&(d.tmax=t.bidTimeout),Array.isArray(t.jwpseg)){d.imp[0].video.ext={jwpseg:t.jwpseg};var c=t.jwpseg.map((function(e){return{id:e,bidfloor:d.imp[0].bidfloor,bidfloorcur:d.imp[0].bidfloorcur}}));d.imp[0].pmp={private_auction:0,deals:c}}return r.getGDPRConsentData().then((function(e){var t=e.gdprApplies,i=e.consentData;d.regs={ext:{gdpr:t?1:0}},t&&(d.user={ext:{consent:i}})})).then((function(){return new Promise((function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4===this.readyState&&(e(this),t=null)},t.open("POST",a.endpoint),a.preflight&&(t.setRequestHeader("content-type","application/json"),t.setRequestHeader("x-openrtb-version","2.5")),t.withCredentials=!0,t.send(JSON.stringify(d)),i.then((function(){t&&(t.abort(),t=null)}))}))})).then((function(i){if(200===i.status){var a=JSON.parse(i.responseText),s=t.floorPriceCurrency||et,o=a.cur?a.cur.toUpperCase():s;if(s!==o)return{result:Ht,code:551};if(a.id===d.id&&a.seatbid&&a.seatbid.length){var l,u=a.seatbid.reduce((function(e,t){if(null===e&&t&&t.bid&&t.bid.length){var i=t.bid.filter((function(e){return e.impid===d.imp[0].id}));if(i.length)return l=t.seat,i[0]}return e}),null);if(u){if(u.adm){var c=r.parseXML(u.adm);if(null===c)return{result:Dt,code:331};u.adm=ei(c.documentElement)}else if(!u.nurl)return{result:Dt,code:330};var h={id:d.id,bid:a.bidid,imp:u.impid,seat:l,ad:u.adid,cur:o},p={result:Bt,priceInCents:100*u.price,priceCurrency:o,adm:u.adm?ii(u.adm,h):null,custom:{exp:u.exp,nurl:u.nurl?ii(u.nurl,h):null,lurl:u.lurl?ii(u.lurl,h):null}};if(t.mediationLayerAdServer===lt||t.mediationLayerAdServer===ct){var f,v=r.genId(12),m=e.name.toLowerCase();p.adm||(p.adm=function(e,t){return'\n<VAST version="4.0">\n    <Ad id="'.concat(e,'">\n        <Wrapper>\n            <AdSystem version="').concat("0.2.21",'">JWP</AdSystem>\n            <VASTAdTagURI><![CDATA[').concat(t,"]]></VASTAdTagURI>\n        </Wrapper>\n    </Ad>\n</VAST>\n")}(v,p.custom.nurl)),p.cacheKey=v,p.custParams=(n(f={},["vpb_".concat(m,"_key")],v),n(f,["vpb_".concat(m,"_bid")],Jt(t.buckets,u.price).toFixed(2)),f)}return p}}return{result:qt,code:void 0!==a.nbr?a.nbr+400:Nt[qt]}}return 204===i.status?{result:qt}:400===i.status?{result:Dt}:{result:Ht}}))}};var ai={requestBids:function(e,t,i,r){var n=e.id,a=r.getURLParts(),s=function(e,t,i,r){return["https://an.facebook.com/v2/placementbid.json?&placementids[]=".concat(e),"&playerwidth=".concat(t),"&playerheight=".concat(i),"&adformats[]=".concat(rt),"&SDK[]=".concat(nt),"&pageurl=".concat(encodeURIComponent(r.url)),"$random=".concat(Math.random()*Math.pow(10,18))].join("")}(n,t.playerWidth,t.playerHeight,a);return function(e,t,i,r){return!!r&&(e===lt||t&&i===et)}(t.mediationLayerAdServer,t.floorPriceCents,t.floorPriceCurrency||et,s)?new Promise((function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4===this.readyState&&(e(this),t=null)},t.open("GET",s),t.withCredentials=!0,t.send(null),i.then((function(){t&&(t.abort(),t=null)}))})).then((function(e){if(200!==e.status)return{result:Ht,message:"Invalid response (status ".concat(e.status,")")};var i,r,s=JSON.parse(e.responseText),o=s.errors,l=s.request_id;if(o&&o.length)return{result:Dt,code:(i=o[0],r=$t.filter((function(e){return i.indexOf(e.message)>=0}))[0],r?r.code:zt),requestId:l};var d=s.bids;if(!d||!d[n]||!d[n][0])return{result:qt,requestId:l};var u=d[n][0],c=u.bid_price_cents,h=u.bid_id;if(t.mediationLayerAdServer===lt||t.mediationLayerAdServer===ct)return{result:Bt,tag:t.tag,custParams:{jwFANBidPrice:Jt(t.buckets,c/100).toFixed(2),jwFANBidID:h},requestId:l};var p={result:Bt,priceInCents:c,priceCurrency:u.bid_price_currency,requestId:l};return c>=t.floorPriceCents&&(p.tag=function(e,t,i,r,n){return["https://an.facebook.com/v1/instream/vast.xml?placementid=".concat(e),"&playerwidth=".concat(i),"&playerheight=".concat(r),"&SDK[]=".concat(nt),"&bidid=".concat(t),"&pageurl=".concat(encodeURIComponent(n.url))].join("")}(n,h,t.playerWidth,t.playerHeight,a)),p})).catch((function(e){return{result:Ht,message:"FAN header bidding failed: ".concat(e)}})):Promise.resolve({result:Dt})}},si=null;function oi(e){return null===si&&(si=Promise.resolve(window.apstag).then((function(t){return t&&t.init&&t.fetchBids?t:Zt(["file"===document.location.protocol?"https:":"",it].join(""),e).then((function(){return window.apstag}))})).catch((function(e){throw si=null,e}))),si}var li,di=null,ui=null;function ci(e,t){if(null===ui){var i=Gt(),r=di||window.SpotX;if(r&&r.DirectAdOS)return ui=Promise.resolve({SpotX:r,loadingTime:0});var n=["file"===document.location.protocol?"https:":"",st,e,".js"].join("");(ui="function"==typeof require?(a=n,new Promise((function(e,t){setTimeout(t,Ze),require([a],e,t)})).catch((function(){return Promise.reject({message:yt})}))).then((function(e){return{SpotX:di=e,loadingTime:Gt()-i}})).catch((function(){return hi(n,i,t)})):hi(n,i,t)).catch((function(){ui=null}))}var a;return ui}function hi(e,t,i){return Zt(e,i).then((function(){return{SpotX:window.SpotX,loadingTime:Gt()-t}}))}var pi={postAuctionHandler:function(e){return e.scriptLoadingTime=li,e},requestBids:function(e,t,i,r){if(!e.id)return Promise.resolve({result:Dt,code:302});var n={placement:t.placement,hide_skin:!0,no_vpaid_ads:!1},s={channel_id:e.id,slot:t.playerContainer,content_width:t.playerWidth,content_height:t.playerHeight,player_vendor:"SpotXJW",player_vendor_id:t.playerId,ad_volume:t.adVolume,ad_mute:t.mute?1:0,autoplay:t.autoplay,blocked_autoplay_override_mode:t.autoplayAdsMuted,start_delay:Yt(t.offset)},o=a(n,e.optionalParams,s);return e.passFloorPrice&&t.floorPriceCents&&(o.price_floor=t.floorPriceCents/100),t.jwpseg&&(o.custom=o.custom||{},o.custom.jwpseg=t.jwpseg),ci(e.id,r).then((function(e){var t=e.SpotX,i=e.loadingTime;li=i;var r=new t.DirectAdOS(o),n=Gt();return r.getAdServerKVPs().then((function(e){return{response:e,bidNetworkStartTime:n}}))})).then((function(e){var i=e.response,r=e.bidNetworkStartTime,n=Gt()-r,s=i.spotx_ad_key,o={spotx_bid:Jt(t.buckets,i.spotx_bid).toFixed(2),spotx_ad_key:s},l=100*parseFloat(i.spotx_bid),d={result:Bt,priceInCents:l,custParams:o,scriptLoadingTime:li,bidNetworkResponseTime:n};return t.mediationLayerAdServer===lt?d:a(d,{tag:["file:"===document.location.protocol?"https:":"",ot,s].join(""),tagKey:s})})).catch((function(e){var t=Wt.filter((function(t){return t.message===e.message}))[0];return t?{result:t.result||Dt,code:t.code,scriptLoadingTime:li}:{result:Ht,message:"SpotX header bidding failed: ".concat(e),scriptLoadingTime:li}}))}},fi=null;function vi(e,t){return null===fi&&(fi=Promise.resolve(window.indexapi).then((function(i){return i||Zt(["file"===document.location.protocol?"https:":"",e||at].join(""),t).then((function(){return window.indexapi}))})).catch((function(e){throw fi=null,e}))),fi}var mi,gi={requestBids:function(e,t,i,r){if(!e.id&&!e.script)return Promise.resolve({result:Dt});var n=a({videoCommonArgs:{protocols:[2,3,5,6],mimes:["video/mp4","video/webm","application/javascript"],apiList:[1,2]},siteID:e.id},e);return vi(e.script,r).then((function(e){return new Promise((function(i){e.deferQueue=e.deferQueue||[],e.deferQueue.push((function(){e.solicitIndexVideoAds(t.tag,(function(e,t){i({updatedTag:e,indexTargeting:t})}),n)}))}))})).then((function(e){var i=e.indexTargeting;return void 0!==i?{result:Bt,tag:t.tag,custParams:i}:{result:qt}})).catch((function(e){return{result:Ht,message:"Index Exchange header bidding failed: ".concat(e)}}))}},yi=(n(mi={},[pt],{requestBids:function(e,t,i,r){return e.id&&e.slotID?oi(r).then((function(i){return i.init({id:e.pubId,adServer:e.adServer}),new Promise((function(r){i.fetchBids({slots:[{slotID:e.slotID}],timeout:t.bidTimeout},r)}))})).then((function(i){return i&&i[0]&&i[0].slotID===e.slotID?{result:Bt,tag:t.tag,custParams:{amznbid:i[0].amznbid,amzniid:i[0].amzniid}}:{result:qt}})).catch((function(e){return{result:Ht,message:"Amazon header bidding failed: ".concat(e)}})):Promise.resolve({result:Dt})}}),n(mi,["FAN"],ai),n(mi,[ft],gi),n(mi,[vt],ni),n(mi,[mt],pi),mi),ki=function(e,t){var i=t.parseXML(e.adm);if(null===i)return e.adm;for(var r=t.getTrackingPixelURLs(e.name,e.cacheKey),n=r.impression,a=r.error,s=i.querySelectorAll("InLine,Wrapper"),o=0;o<s.length;o+=1)s[o].appendChild(Kt(i,"Impression",n,{id:e.cacheKey})),s[o].appendChild(Kt(i,"Error",a));return ei(i)},Ai=function(e,t,i){var r=e.filter((function(e){return e&&e.result===Bt&&e.adm&&e.cacheKey}));return 0===r.length?Promise.resolve({bids:e}):new Promise((function(e){var n=r.map((function(e){return{type:"xml",ttlseconds:(e.custom||{}).exp||86400,value:i.getTrackingPixelURLs?ki(e,i):e.adm,key:e.cacheKey}})),a=Gt(),s=function(t){return function(){e({result:t,code:this.status,time:Gt()-a|0}),o=null}},o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===this.readyState){var e=200===this.status?Bt:Ht;s(e)()}},o.onabort=s("abort"),o.onerror=s(Ht),o.ontimeout=s("timeout"),o.open("POST","https://vpb-cache.jwplayer.com/cache"),o.send(JSON.stringify({puts:n})),t.then((function(e){var t=e.result;o&&(o.onabort=s(t),o.abort(),o=null)}))})).then((function(t){var i=t.result,n=t.code,a=t.time;return r.forEach((function(e){var t,r;e.result=i,e.result===Ht&&(e.code=(t=n,r=100*parseInt(t/100,10),Qt[t]||Qt[r]||Xt))})),{bids:e,time:a}}))};var wi=function(){function e(){var i=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.settings,s=void 0===n?{}:n,o=r.bidders,l=void 0===o?[]:o,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2?arguments[2]:void 0;t(this,e),this.settings=function(e,t){var i=a({bidTimeout:Ye,buckets:[],offset:"",playerContainer:t.container,playerHeight:t.height||0,playerWidth:t.width||0,tag:"",placement:1},t,e);return gt[i.mediationLayerAdServer]||(i.mediationLayerAdServer=ht),i.mediationLayerAdServer===ut&&(i.floorPriceCents=tt),i.floorPriceCurrency?i.floorPriceCurrency=i.floorPriceCurrency.toUpperCase():void 0!==i.floorPriceCents&&(i.floorPriceCurrency=et),i}(s,d),this.utils=u,this.eventProps={};var c=0===Yt(this.settings.offset),h=this.settings.mediationLayerAdServer===dt||this.settings.mediationLayerAdServer===ct,p=gt[this.settings.mediationLayerAdServer];this.bidders=l.filter((function(e){return(!isNaN(parseFloat(i.settings.floorPriceCents))||!h)&&(-1!==p.indexOf(e.type||e.name)&&(c||e.type===vt||e.name===mt))})).map((function(e){return e.name===pt&&e.id&&e.slotID?oi(u):e.name===ft&&(e.script||e.id)?vi(e.script,u):e.name===mt&&e.id&&ci(e.id,u),a(e,e.custom_params)})),this._bidRequest=null,this._currentTimeout=null,this._onCancelTrigger=null,this.onCancel=new Promise((function(e){i._onCancelTrigger=e}))}return r(e,[{key:"start",value:function(){var e,t,i,r,n,s,o,l,d,u,c,h;return this._bidRequest||(this._bidRequest=(e={bidders:this.bidders,eventProps:this.eventProps,settings:this.settings,onCancel:this.onCancel,utils:this.utils},t=e.bidders,i=e.eventProps,r=e.settings,n=e.onCancel,s=e.utils,o=r.mediationLayerAdServer===lt||r.mediationLayerAdServer===ct,l=r.mediationLayerAdServer===dt||r.mediationLayerAdServer===ct||r.mediationLayerAdServer===ut,d=[],u=null,c=null,h=t.map((function(e,t){var h=Gt(),p=Promise.race([yi[e.type||e.name].requestBids(e,r,n,s),n]).then((function(t){var i=a({},e,t,{timeForBidResponse:Gt()-h|0},l&&{winner:!1});return l&&i.result===Bt&&i.priceInCents>=r.floorPriceCents&&(null===c||i.priceInCents>c.priceInCents)&&(c=i),i})).catch((function(t){return a({},e,{result:Ht,code:Ft,message:t,timeForBidResponse:Gt()-h|0})}));return o&&e.type===vt?(d[t]=p,p.then((function(e){return null===u&&(u=Promise.all(d).then((function(e){return null!==c?e:Ai(e,n,s).then((function(e){var t=e.bids,r=e.time;return i.timeForVPBCache=r,t}))}))),u.then((function(e){return e[t]})).catch((function(t){return a(e,{result:Ht,code:Ut,message:t})}))}))):p})),Promise.all(h).then((function(e){if(l&&c)return c.winner=!0,{bidders:e,result:c};if(o){var t=e.reduce((function(e,t){return t.result===Bt?a(e||{},t.custParams):e}),null),i={bidders:e};return null!==t&&(i.result={tag:r.tag,custParams:t}),i}return{bidders:e}})).then((function(e){return e.bidders=e.bidders.map((function(t){t.code=t.code||Nt[t.result];var i=yi[t.type||t.name];return"function"==typeof i.postAuctionHandler?i.postAuctionHandler(t,e.result):t})),a(t,e.bidders),e})))),this._bidRequest}},{key:"stop",value:function(){var e=this;clearTimeout(this._currentTimeout),this._onCancelTrigger({result:"abort"}),this._bidRequest=null,this._currentTimeout=null,this._onCancelTrigger=null,this.onCancel=new Promise((function(t){e._onCancelTrigger=t}))}},{key:"getEventObject",value:function(){var e=this.settings.mediationLayerAdServer,t={bidsVersion:"0.2.21",mediationLayerAdServer:e,bidders:s(this.bidders),bidTimeout:this.settings.bidTimeout};e!==dt&&e!==ct||(t.floorPriceCents=+this.settings.floorPriceCents||0);var i=this.settings.floorPriceCurrency;return i&&(t.floorPriceCurrency=i),void 0!==this.eventProps.timeForVPBCache&&(t.timeForVPBCache=this.eventProps.timeForVPBCache),t}},{key:"then",value:function(e){return this._bidRequest?this._bidRequest.then(e,e):null}},{key:"timeout",value:function(){clearTimeout(this._currentTimeout),this._currentTimeout=setTimeout(this._onCancelTrigger,this.settings.bidTimeout,{result:"timeout"})}}]),e}(),Pi=function(){},bi=function(){function e(i,r,n,s,o){t(this,e),this.config=s,this.item=n,this.params=o,this.player=i,this.schedule=r,this.vmapPromise=null,this._preRollPromise=null,this._midRollPromise={},this._postRollPromise=null,this.vmapTracker=null,this._events=[],this._vloaderQueue=[],this._staticAdsOffset=[],this.bids=[],this.bidsPromise=null,this.bidsResult={},this._debugTrackFn=s.debug&&s.trackFn?s.trackFn:null,a(this,i.Events)}return r(e,[{key:"init",value:function(e,t){var i=this,r=this.schedule;return r.isVMAP()&&(this.vmapPromise=r._vmapPromise.catch(Pi)),this.bidsPromise=this.vmapPromise||Promise.resolve(),null!==e&&(this.bidsPromise=this.bidsPromise.then((function(){return i.isDestroyed()?null:i._createBidsPromise(e,t)}))),this.bidsPromise}},{key:"_createBidsPromise",value:function(e,t){var i=this,r=this.player,n=parseInt(e.bidOnBreaks,10);return n=n>0?n:1/0,this.bids=this.schedule.getAllAds().slice(0,n).map((function(n){var s=i.getAdIds(n),o=s.adBreakId,l=s.adPlayId,d=r.getConfig(),u=i.config.skipoffset,c=null!=u&&u>=0,h=le(r,i.item),p=i.bidsResult[o]=new wi(e,{adPlayId:l,offset:n._offSet,width:r.getWidth(),height:r.getHeight(),container:r.getContainer(),playerId:r.id,autoplay:d.autostart,autoplayAdsMuted:i.config.autoplayadsmuted,adVolume:r.getVolume(),mute:r.getMute(),placement:se(d),skipoffset:c?u:-1,language:i.config.locale||r.getConfig().language,viewable:1===r.getViewable(),jwpseg:h},{genId:r.utils.genId,getGDPRConsentData:re,getURLParts:ae,parseXML:r.utils.parseXML,scriptloader:r.utils.scriptloader});return p.start(),i.trigger(b,he(i,n,a({jwpseg:h},t))),p.then((function(e){var r=e.result;i.isDestroyed()||(r&&!r.error&&(r.adm?(n.jwpseg=h,n._adXML=r.adm,n._adQueue&&n._adQueue.length&&n._adQueue.unshift(r.adm)):r.tag&&(n.jwpseg=h,n._adQueue=n._adQueue||[],n._adQueue.unshift(r.tag))),i.trigger(_,he(i,n,t)))})),p})),Promise.all(this.bids)}},{key:"getAdIds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.tagIndex,r=t.podIndex,n=e.adRequestIds&&void 0!==i?e.adRequestIds[i]:null;if(!n){var a=r||e._adPodIndex||0,s="p".concat(a,"w").concat(e._waterfallIndex||0);n="p0w0"===s?e.adBreakId:e.adPlayIds[s]=e.adPlayIds[s]||this.player.utils.genId(12)}return{adBreakId:e.adBreakId,adPlayId:n}}},{key:"loadPreRoll",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return null===this._preRollPromise&&(this._preRollPromise=this.bidsPromise.then((function(){if(!e.isDestroyed()){var i=e.schedule.getPreRoll(t.startTime);return i?(i._position="pre",e.loadAd(i,t)):void 0}}))),this._preRollPromise}},{key:"loadMidRollAtIndex",value:function(e,t){var i=this;return this._midRollPromise[e]||(this._midRollPromise[e]=this.bidsPromise.then((function(){if(!i.isDestroyed()){var r=i.schedule.getMidRollAtIndex(e);return r?(r._position="mid",i.loadAd(r,t)):void 0}}))),this._midRollPromise[e]}},{key:"loadPostRoll",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return null===this._postRollPromise&&(this._postRollPromise=this.bidsPromise.then((function(){if(!e.isDestroyed()){var i=e.schedule.getPostRoll(t.startTime);return i?(i._position="post",e.loadAd(i,t)):void 0}}))),this._postRollPromise}},{key:"loadAd",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.player.utils;if(e._id=e._id||r.genId(12),this.config.preloadAds&&(e._preload=i.preload||!1),e._vmapTracker=this.getVMAPTracker(e),e._adQueue||e._adXML||e._pod){if(i.adBlock)throw ce(this,{message:"Ad playback blocked by an ad blocker",adErrorCode:600003},e,i);var n;if(e._pod)return this._loadPods(e,i);var a=function(){return t.isDestroyed()?null:t._dispatchAdLoaded(e,i)};return(n=e._adXML?this._loadXML(e,i):this._loadTag(e,i)).then(a).catch(Pi),n.catch(a).catch(Pi),n.catch((function(e){return t.isDestroyed()?null:t._vloaderWaterfall(e,i)}))}r.log("scheduled ad has no url or xml",e)}},{key:"getVMAPTracker",value:function(e){if(!e._vmapTracker){var t=new ue(e,e._trackers,this._debugTrackFn,this.player,this.config.trackingFilter);e._vmapTracker=this.vmapTracker=t}return e._vmapTracker}},{key:"_loadTagUrl",value:function(e,t,i){var r=this;return be(t,this.player,this.item,this.params,e).then((function(n){"function"==typeof r._debugTrackFn&&r._debugTrackFn({type:"tagReplacement",data:{actualTag:n,originalTag:t}});var s=r._createVastLoader(e,i),o=s.load(n);return i.isPodItemLoader?i.tagIndex&&(s.scheduledAd().adRequestIds[i.tagIndex]=r.player.utils.genId(12)):e._currentTag=n,r._dispatchAdRequest(e,a({tag:n},i)),o}))}},{key:"_loadTag",value:function(e,t){var i=e._adQueue[e._waterfallIndex];return this._loadTagUrl(e,i,t)}},{key:"_loadPods",value:function(e,t){var i=this;e.adRequestIds=[];var r=this._createVastLoader(e,t),n=e._pod.map((function(r,n){var s=a({tag:r,isPodItemLoader:!0,tagIndex:n},t),o=i._loadTagUrl(e,r,s).catch((function(e){return e.tagIndex=n,Promise.reject(e)})),l=function(){return i.isDestroyed()?null:i._dispatchAdLoaded(e,s)};return o.then(l).catch(Pi),o.catch(l).catch(Pi),o}));return r.podMultipleVastLoaders(n)}},{key:"_loadXML",value:function(e,t){var i;e._currentTag=e._currentTag||((i=e._adXML).ownerDocument instanceof Document?i.outerHTML||(new XMLSerializer).serializeToString(i):null)||e._adXML.toString();var r=this._createVastLoader(e,t).parseXMLString(e._adXML,e._currentTag);return this._dispatchAdRequest(e,t),r}},{key:"_dispatchAdRequest",value:function(e,t){this.trigger(L,he(this,e,a({jwpseg:e.jwpseg},t)))}},{key:"_dispatchAdLoaded",value:function(e,t){this.trigger(x,he(this,e,t))}},{key:"_handleVastLoadError",value:function(e,t,i){var r=e.vloader;return this.removeVastLoader(r),this._getVloaderErrorObject(e,t,i)}},{key:"_vloaderWaterfall",value:function(e,t){var i=this._handleVastLoadError(e,null,t),r=e.vloader;return this.adWaterfall(r,i,t)}},{key:"adWaterfall",value:function(e,t,i){var r=e.scheduledAd();if(this.schedule.canWaterfall(r))return r.jwpseg=null,r._adXML=null,r._waterfallIndex+=1,this._enqueueAdEvent(C,t,i),this.loadAd(r,i);throw t}},{key:"addStaticOffset",value:function(e){this._staticAdsOffset.push(e)}},{key:"_createVastLoader",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.config,n=new Ke(e,this.player,a({requestFilter:r.requestFilter,trackingFilter:r.trackingFilter},i));this._vloaderQueue.push(n);var s=0;return n.on(M,(function(r){s+=1;var a=t._getVloaderErrorObject(r,null,i);if(t._enqueueAdEvent(C,a,i),!(n._scheduledAd._pod&&n._scheduledAd._pod.length===s)){var o=he(t,e,{podIndex:n._scheduledAd._adPodIndex,tagIndex:s},i);t._enqueueAdEvent(R,o,i)}})),n}},{key:"_getVloaderErrorObject",value:function(e,t,i){e.wrapperAdSystem&&e.wrapperAdSystem.length!==e.wrappedTags.length&&(e.wrapperAdSystem.push(e.adsystem),e.adsystem="");var r=a({adsystem:e.adsystem,wrapper:e.wrapperAdSystem,wrappedTags:e.wrappedTags},e.vloader.scheduledAd());return ce(this,e,r,a({tag:e.tag,tagIndex:e.tagIndex||t,podIndex:e.podIndex},a({jwpseg:r.jwpseg},i)))}},{key:"_enqueueAdEvent",value:function(e,t,i){this._events.push({type:e,event:t}),i.preload||this.dequeueAdEvents()}},{key:"dequeueAdEvents",value:function(){var e=this;this._events.forEach((function(t){var i=t.type,r=t.event;return e.trigger(i,r)})),this._events.splice(0)}},{key:"removeVastLoader",value:function(e){var t=this._vloaderQueue.indexOf(e);-1!==t&&(e.destroy(),this._vloaderQueue.splice(t,1))}},{key:"isDestroyed",value:function(){return null===this.player}},{key:"destroy",value:function(){this.bids.forEach((function(e){return e.stop()})),this._vloaderQueue.forEach((function(e){return e.destroy()})),this.player=null}}]),e}(),_i=document.createElement("img"),Ti=document.createElement("img");_i.src=Ti.src='data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><circle cx="32" cy="32" r="32" fill="%23191919"/><line stroke="%23CCC" stroke-width="6" x1="32" y1="20" x2="32" y2="44"/><line stroke="%23CCC" stroke-width="6" x1="20" y1="32" x2="44" y2="32"/></svg>',_i.className="jw-vast-nonlinear-open-button",Ti.className="jw-vast-nonlinear-close-button";var Ii=function(){function e(i,r,n,s,o){t(this,e),this.player=i,this.environment=i.getEnvironment(),this.div=s,this.staticURL=r,this.clickURL=n,this.loadTimer=-1,this.animationTimer=-1,this.banner=null,a(this,i.Events),this.banner=document.createElement("img"),this.banner.className="jw-banner",this.banner.id=this.player.id+"_vast_static",this.div.appendChild(_i),this.div.appendChild(this.banner),this.div.appendChild(Ti),this.loadTimer=setTimeout(this.imageLoadError.bind(this),o),this.banner.onerror=this.imageLoadError.bind(this),this.banner.onload=this.onLoaded.bind(this),this.banner.src=this.staticURL}return r(e,[{key:"onLoaded",value:function(){if(clearTimeout(this.loadTimer),0!==this.banner.naturalWidth){this.removeBannerEventListeners();var e=this.player.utils;e.addClass(this.div,"jw-vast-nonlinear-active"),e.style(Ti,{bottom:this.banner.height-8,left:this.banner.width},!0),new e.UI(this.banner).on("click tap",this.sendClick.bind(this)),Ti.onclick=Ti.ontouchstart=this.collapse.bind(this),_i.onclick=_i.ontouchstart=this.expand.bind(this),this.trigger(D)}else this.imageLoadError()}},{key:"imageLoadError",value:function(){clearTimeout(this.loadTimer),this.trigger(q),this.removeBanner()}},{key:"sendClick",value:function(){this.trigger(H)}},{key:"collapse",value:function(e){var t=this;e.preventDefault(),this.player.utils.addClass(this.div,"jw-vast-nonlinear-collapsed"),this.animationTimer=setTimeout((function(){t.remove(t.banner),t.remove(Ti),t.animationTimer=-1}),250)}},{key:"expand",value:function(e){-1===this.animationTimer&&(e.preventDefault(),this.player.utils.removeClass(this.div,"jw-vast-nonlinear-collapsed"),this.div.appendChild(this.banner),this.div.appendChild(Ti))}},{key:"remove",value:function(e){this.div.contains(e)&&this.div.removeChild(e)}},{key:"removeBannerEventListeners",value:function(){this.banner.onload=this.banner.onerror=null}},{key:"removeBanner",value:function(){this.removeBannerEventListeners(),this.remove(this.banner)}},{key:"removeListeners",value:function(){clearTimeout(this.loadTimer),clearTimeout(this.animationTimer),Ti.onclick=Ti.ontouchstart=_i.onclick=_i.ontouchstart=null,this.off(),this.removeBannerEventListeners()}},{key:"stop",value:function(){this.player.utils.removeClass(this.div,"jw-vast-nonlinear-active jw-vast-nonlinear-collapsed"),this.removeBanner(),this.remove(Ti),this.remove(_i)}}]),e}(),Ei=function(){function e(i,r){t(this,e),this.player=i,this.div=r,this.startTime=0,this.minDur=0,this.environment=i.getEnvironment(),a(this,i.Events),this.type="static",i.on("time",this.dispatchTime,this)}return r(e,[{key:"playAd",value:function(e,t,i,r,n){this.minDur=this.player.utils.seconds(i),this.adTag=r,this.static&&(this.static.removeListeners(),this.static.stop()),this.player.utils.addClass(this.div,"jw-vast-nonlinear"),this.static=new Ii(this.player,e,t,this.div,n),this.static.on(D,this.startAd,this),this.static.on(H,this.clickHandler,this),this.static.on(q,this.errorHandler,this)}},{key:"dispatchTime",value:function(e){this.trigger(u,e)}},{key:"startAd",value:function(){this.startTime=this.player.getPosition(),this.minDur>0&&(0===this.startTime?this.on(u,this.startTimingAd,this):this.on(u,this.timeAd,this)),this.sendEvent(D)}},{key:"startTimingAd",value:function(e){this.startTime=e.position,this.off(u,this.startTimingAd,this),this.on(u,this.timeAd,this)}},{key:"timeAd",value:function(e){e.position-this.startTime>this.minDur&&(this.off(u,this.timeAd,this),this.stop())}},{key:"clickHandler",value:function(){this.sendEvent(H)}},{key:"errorHandler",value:function(){this.sendEvent(q)}},{key:"sendEvent",value:function(e,t){(t=t||{}).tag=t.tag||this.adTag,this.trigger(e,t)}},{key:"removeEvents",value:function(){this.off()}},{key:"getState",value:function(){return P}},{key:"stop",value:function(){this.startTime&&this.static&&(this.startTime=0,this.minDur=0,this.off(u,this.startTimingAd,this),this.off(u,this.timeAd,this),this.static.removeListeners(),this.static.stop(),this.sendEvent(N))}},{key:"pause",value:function(){}}]),e}(),Ci=function(){function e(i,r){t(this,e),this.player=i,this.options=r,this.ignoreStartOnSeek=!1,this.reset(),r.timeBetweenAds&&i.on({adBreakStart:this.handleAdBreakStart,adSkipped:this.handleAdSkipped,adComplete:this.handleAdComplete,adBreakEnd:this.handleAdBreakEnd,destroyPlugin:this.destroy},this)}return r(e,[{key:"shouldDeferAds",value:function(){return this.options.deferAds&&!this.player.getConfig().activeTab}},{key:"clearStartOnSeek",value:function(){this.ignoreStartOnSeek=!0}},{key:"sendAdBreakIgnored",value:function(e,t){e&&this.player.trigger(I,function(e,t){return{id:e._breakId,tag:e._adQueue&&e._adQueue.length>0?e._adQueue[0]:e._adXML,client:l,offset:e._offSet,timeSinceLastAd:t,type:I}}(e,t))}},{key:"rulesAllowAdPlayback",value:function(e){var t=this.options,i=0===t.frequency&&1===e,r=e>=t.startOn&&(e-t.startOn)%t.frequency==0;return i||r}},{key:"handleAdBreakStart",value:function(){this.adSkipped=!1,this.adComplete=!1}},{key:"handleAdComplete",value:function(){this.adComplete=!0}},{key:"handleAdSkipped",value:function(){this.adSkipped=!0}},{key:"handleAdBreakEnd",value:function(){!this.adSkipped&&this.adComplete&&(this.recentCompletedAdTime=ne())}},{key:"timeBetweenAdsAllowsAdPlayback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ne();if(this.options.timeBetweenAds){var i=(t-this.recentCompletedAdTime)/1e3;if(i<this.options.timeBetweenAds)return this.sendAdBreakIgnored(e,i),!1}return!0}},{key:"reset",value:function(){this.ignoreStartOnSeek=!1,this.recentCompletedAdTime=0}},{key:"destroy",value:function(){this.player.off(null,null,this)}},{key:"timeBetweenAds",get:function(){return this.options.timeBetweenAds}},{key:"startOnSeek",get:function(){return this.ignoreStartOnSeek?null:this.options.startOnSeek}}]),e}(),Si={};var Ri=function(){};!function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");t.setAttribute("media","screen"),t.innerHTML=e,document.head.appendChild(t)}}(".jwplayer.jw-flag-time-slider-above .jw-vpaid-non-linear{bottom:66px}.jwplayer.jw-breakpoint-7 .jw-vpaid-non-linear{bottom:132px}.jwplayer.jw-flag-user-inactive:not(.jw-state-paused) .jw-vpaid-non-linear{bottom:.5em}.jwplayer .jw-vpaid-non-linear{bottom:60px}.jwplayer .jw-vpaid-iframe{border:0;width:100%;height:100%;position:absolute;overflow:hidden}.jwplayer .jw-plugin-vast.jw-plugin{top:0;width:100%;pointer-events:none}.jwplayer .jw-plugin-vast.jw-plugin *{pointer-events:all}.jwplayer .jw-plugin-vast .jw-ad-icon-container{position:absolute;display:none;pointer-events:all;cursor:pointer}.jwplayer .jw-plugin-vast .jw-ad-icon-container.jw-ad-icon-active{display:block}.jwplayer .jw-plugin-vast .jw-ad-icon-container iframe{pointer-events:none;border:none;height:100%;width:100%;margin:0}.jw-plugin-vast.jw-vast-nonlinear-active .jw-banner{opacity:1}.jw-plugin-vast.jw-vast-nonlinear-active .jw-vast-nonlinear-close-button{margin:0 auto;opacity:.75}.jw-plugin-vast.jw-vast-nonlinear-active:hover .jw-vast-nonlinear-close-button{opacity:1}.jw-plugin-vast.jw-vast-nonlinear-collapsed .jw-vast-nonlinear-open-button{margin:0 auto;opacity:.5}.jw-plugin-vast.jw-vast-nonlinear-collapsed .jw-banner,.jw-plugin-vast.jw-vast-nonlinear-collapsed .jw-vast-nonlinear-close-button{opacity:0}.jw-plugin-vast.jw-vast-nonlinear-collapsed:hover .jw-vast-nonlinear-open-button{opacity:1}.jw-plugin-vast.jw-vast-nonlinear-collapsed:hover .jw-vast-nonlinear-close-button{opacity:0}.jw-plugin-vast .jw-vast-nonlinear-close-button,.jw-plugin-vast .jw-vast-nonlinear-open-button{position:absolute;right:0;bottom:0;left:0;display:block;margin:auto;width:18px;height:18px;cursor:pointer;opacity:0;transition:opacity .2s ease}.jw-plugin-vast .jw-vast-nonlinear-close-button{transform:rotate(45deg)}"),(window.jwplayerPluginJsonp||window.jwplayer().registerPlugin)(l,"8.1",(function(e,t,i){var r=e.getConfig(),s=r.key,o=e.getEnvironment(),l=t.debug&&t.trackFn?t.trackFn:null,c=this,h=null,f=t.bids&&t.bids.settings?t.bids.settings.mediationLayerAdServer||g:null;if((f===g||f===y)&&t.bids.bidders){var I=t.bids.bidders;I.length&&(h=a({},t.bids,{bidders:I}))}var B,H,D,q,N,F,U={},X=!1,Q=[],W=!1,z=0,$=0,G=!1,J=!1,K=null,Y=!1,Z=new Qe(e.utils),ee=new Ci(e,Z.getAdRules(t)),te=new e.utils.Timer;this.version="8.7.10",this.bidsVersion="0.2.21";var ie=new Fe(ee,e.utils),re=Z.getSchedule(t,ee);function ae(e){le();var t=B;Promise.resolve(e).then((function(){if(!t.isDestroyed())return se(e),t.loadAd(e,{adBlock:G})})).then((function(e){return t.isDestroyed()?null:fe(e,V)})).catch((function(e){return t.isDestroyed()?null:be(e)}))}function se(t,i){var r=B,n=r.getVMAPTracker(t);N.once("destroyed",(function(){te.clear("adBreakStart"),n.breakEnd(),e.trigger(T,he(r,t)),B===r&&B.schedule.resetBreakIdByOffset(i)})),te.tick("adBreakStart"),n.breakStart();var a=he(r,t);e.trigger(E,a),e.trigger(R,a)}function oe(t){if(J||(J=!0,B.bids.forEach((function(e){return e.timeout()}))),!(W||X||ee.shouldDeferAds())){X=!0;var i=(t||{}).startTime||e.getPosition();$=i||$;var r=B.schedule.getPreRoll(i);if(r||B.vmapPromise){(null!==B.vmapPromise||r&&"nonlinear"!==r._type)&&le();var n=B;n.bidsPromise.then((function(){if(!n.isDestroyed()){var e=n.schedule.getPreRoll(i);e&&"nonlinear"!==e._type&&se(e,"pre")}})),i?"none"===ee.startOnSeek&&(B._preRollPromise=null):ee.clearStartOnSeek(),n.loadPreRoll({adBlock:G,startTime:i}).then((function(e){var i=t&&t.playReason?t.playReason:V;return n.isDestroyed()?null:fe(e,i)})).catch((function(e){return n.isDestroyed()?null:be(e)}))}}}function le(){N||(N=e.createInstream().init()).setText(null)}function de(i,r){var a,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=function(e,t){return ee.rulesAllowAdPlayback(t)?e&&e.adschedule?Z.getSchedule(e,ee):re:ie}(i,r),l=new bi(e,o,i,t,U);return l.on((n(a={},[b],(function(t){return e.trigger(b,t)})),n(a,[_],(function(t){return e.trigger(_,t)})),n(a,[R],(function(t){return e.trigger(R,t)})),n(a,[L],Pe),n(a,[x],we),n(a,[C],_e),a),c),o.isVMAP()&&(s.requestTimeout=o.requestTimeout,s.creativeTimeout=o.creativeTimeout,o.load(e,i,U).then((function(e){l.isDestroyed()||e.forEach((function(e){_e(ce(l,e,null,s))}))})).catch((function(e){l.isDestroyed()||be(ce(l,e,null,s))}))),l.init(h,s).then((function(){l.isDestroyed()||e.trigger(O,he(l,null,{schedule:o}))})),l}function ue(){B&&(B.schedule.reset(),B.off(null,null,c),B.destroy(),B=null),me(),ke(),ye(),ee.reset(),e.setCues([]),$=0,X=!1,J=!1}function fe(t,r){if(B.dequeueAdEvents(),t)return"nonlinear"===t.scheduledAd()._type&&ke(),function(t,r){var n=t.scheduledAd();0===n._waterfallIndex&&ye();B.removeVastLoader(t);var a=new Promise((function(n,a){var s=new ve(t,e,D,q,B,i,U);s.on(j,n),s.on(C,a),s.on(S,ge),s.on(M,_e),s.init(N,r).catch(Ri),H=N,N=null,Q.push(s)})),s=B;return a.then((function(){s.isDestroyed()||"nonlinear"===n._type||ke()})).catch((function(e){if(!s.isDestroyed())return N=N||H,s.adWaterfall(t,e,{adBlock:G}).then((function(e){return s.isDestroyed()?null:fe(e,r)}))}))}(t,r);ke()}function me(){Q.forEach((function(e){return e.destroy()})),Q.splice(0)}function ge(t){Te(t)&&(te.tick("adImpression".concat(t.id)),t.timeLoading=te.between("adBreakStart","adImpression".concat(t.id))),e.trigger(S,t)}function ye(){Q.length&&Q[Q.length-1].clearNonlinear()}function ke(){if(N||H){var e=N||H;N=null,e.destroy()}H=null}function we(t){var i=t.id;te.tick("adLoaded".concat(i)),t.timeLoading=te.between("adLoading".concat(i),"adLoaded".concat(i)),e.trigger(x,t)}function Pe(t){e.trigger(L,t),te.tick("adLoading".concat(t.id))}function be(e){e&&e.adErrorCode||(e=ce(B,{message:"An unexpected ad error has occurred",sourceError:e})),B.dequeueAdEvents(),_e(e),me(),ke()}function _e(t){Te(t)&&(te.tick("adError".concat(t.id)),t.timeLoading=te.between("adBreakStart","adError".concat(t.id))),B&&B.vmapTracker&&B.vmapTracker.error(t.code),50004!==t.adErrorCode&&50901!==t.adErrorCode||!e.getAdBlock()||(G=!0),e.trigger(C,t)}function Te(e){return e.tag&&(void 0===e.podcount||1===e.sequence)}function Ie(t){var i=t.getMidRolls(),r=[];i.length&&i.forEach((function(e){"nonlinear"!==e._type&&r.push({begin:e._offSet,text:U.cuetext})})),e.addCues(r)}re.isVMAP()&&re.load(e,{},U).catch(Ri),a(this,e.Events),e.utils.addClass(i,"jw-plugin-vast"),e.on({all:function(i,r){i===u?function(i){if(W||0===i.duration||ee.shouldDeferAds())return;var r=B.schedule.getNextMidrollIndex($,i.position,i.duration);if($=i.position,null!==r){var n=B.schedule.getMidRollAtIndex(r);"nonlinear"!==n._type&&(le(),se(n,r));var a=B;a.loadMidRollAtIndex(r,{adBlock:G}).then((function(e){return a.isDestroyed()?null:fe(e)})).catch((function(e){return a.isDestroyed()?null:be(e)}))}else if(!X&&B.schedule.getClosestIndex(i.position,i.duration)<0)oe(i);else if(t.preloadAds){var s=i.position+w,o=B.schedule.peek(i.position,s,i.duration);if(null!==o&&o>=0)B.loadMidRollAtIndex(o,{adBlock:G,preload:!0}).catch(Ri);else if(-1===o){var l=ne()+1e3*(i.duration-i.position);B.loadPostRoll({adBlock:G,preload:!0,startTime:l}).catch(Ri)}else if(null===K&&s>i.duration){var d=e.getPlaylistItem(e.getPlaylistIndex()+1);Y=!d,(d||F)&&((K=de(d||F,z+1,{preload:!0})).loadPreRoll({adBlock:G,preload:!0}).catch(Ri),F=null)}}}(r):i===p&&function(){if(W||ee.shouldDeferAds())return;var e=B.schedule.getPostRoll();if(e){"nonlinear"!==e._type&&(le(),se(e,"post"));var t=B;t.loadPostRoll({adBlock:G}).then((function(e){return t.isDestroyed()?null:fe(e)})).catch((function(e){return t.isDestroyed()?null:be(e)}))}}()},ready:function(){var n=this;D=new Ei(e,i),q=new Ae(l,o,{openLink:e.utils.openLink}),r.localization=e.getConfig().localization,(U=Z.getOptParams(t,r.localization.advertising)).debugTrackFn=l,Ee.catch((function(t){ue(),e.off(null,null,n),e.playAd=Ri,_e(ce(null,{message:"Ad Error: ".concat(t.message),adErrorCode:60002,id:d,tag:""}))}))},relatedReady:function(){if(t.preloadAds){var i=e.getPlugin("related");i&&i.on("nextUp",(function(e){e&&"discovery"===e.mode&&(F=e)}))}},beforePlay:oe,cast:function(e){W=!!e.active},play:function(e){c.trigger(P,e)},playlistItem:function(i){z+=1,ue();var n=e.getPlaylistItem(i.index);K&&n!==K.item&&!1===Y&&(K.off(null,null,c),K.destroy(),K=null);B=K||de(n,z),K=null,B.schedule.isVMAP()?B.vmapPromise.then((function(){B.isDestroyed()||Ie(B.schedule)})).catch(Ri):Ie(B.schedule);if(t.preloadAds&&1===z){var a=r.autostart;!1===a||a===A&&0===e.getViewable()?B.loadPreRoll({adBlock:G,preload:!0}).catch(Ri):e.once(k,(function(){B.loadPreRoll({adBlock:G,preload:!0}).catch(Ri)}))}},playlistComplete:ue,complete:function(){ye(),X=!1,J=!1},destroyPlugin:ue},this),e.pauseAd=function(e,t){if(e="boolean"!=typeof e||e,Q.length){var i=Q[Q.length-1];e?i.pause(t||{}):i.play(t||{})}},e.playAd=function(t){var i;ye();var r=0===U.requestTimeout?1/0:U.requestTimeout,n=0===U.creativeTimeout?1/0:U.creativeTimeout;i=Array.isArray(t)?t.slice(0):[t];var a=e.utils.genId,s={_id:a(12),_adQueue:i,_waterfallIndex:0,_adPodIndex:0,adBreakId:a(12),_offset:0,_position:pe(e),requestTimeout:r||v,creativeTimeout:n||m};B?ae(s):e.once("playlistItem",(function(){return ae(s)}))},e.skipAd=function(){Q.length&&Q[Q.length-1].skip()};var Ee=function(e,t,i){var r=Si[t];return r||(Si[t]=new Promise((function(r,n){!function(i){var r=new e.key(t);if("unlimited"===r.edition())return i();var n=[""];"file:"===window.location.protocol&&n.unshift("https:"),e.ajax(n.join(""),(function(e){i(e&&e.response)}),(function(){i()}),{timeout:1e4,responseType:"json"})}((function(e){var t,a,s=e||{};!0===i.outstream?(t=!1!==s.canPlayOutstreamAds,a="Outstream Ad Limit Reached"):(t=!1!==s.canPlayAds,a="Ad Limit Reached"),!1!==t?r({message:"Can Play Ads"}):n({message:a})}))})))}(e.utils,s,t);Ee.catch(Ri),this.destroy=ue}))}();
